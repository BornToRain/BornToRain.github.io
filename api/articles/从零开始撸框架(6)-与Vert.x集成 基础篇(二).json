{"title":"从零开始撸框架(6)-与Vert.x集成 基础篇(二)","uid":"a0a429763c9944ec54d86de5e0e4f445","slug":"从零开始撸框架(6)-与Vert.x集成 基础篇(二)","date":"2021-05-07T03:54:00.000Z","updated":"2021-05-10T10:02:35.468Z","comments":true,"path":"api/articles/从零开始撸框架(6)-与Vert.x集成 基础篇(二).json","keywords":["Coder","Scalaer","Javaer"],"cover":"/images/vertxlogo.png","content":"<p>这一章我们来将上一章中的 <em>Verticle</em> 在Vert.x中运行起来.</p>\n<h2 id=\"Vert-x原始使用方式\"><a href=\"#Vert-x原始使用方式\" class=\"headerlink\" title=\"Vert.x原始使用方式\"></a>Vert.x原始使用方式</h2><p>样例来自于<a href=\"https://vertx.io/\">Vert.x官网</a></p>\n<h3 id=\"部署Verticle并运行Vert-x\"><a href=\"#部署Verticle并运行Vert-x\" class=\"headerlink\" title=\"部署Verticle并运行Vert.x\"></a>部署Verticle并运行Vert.x</h3><div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">HelloWorld</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">main</span><span style=\"color: #657B83\">() &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 单例</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// Vertx vertx = Vertx.vertx();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 集群</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Vertx</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">clusteredVertx</span><span style=\"color: #657B83\">(options, ar </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val vertx </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">ar</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">result</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">deployVerticle</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Server</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getName</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p>这里贴出来方便参考,下面开始与Vert.x的集成.</p>\n<h2 id=\"Vert-x集成基类\"><a href=\"#Vert-x集成基类\" class=\"headerlink\" title=\"Vert.x集成基类\"></a>Vert.x集成基类</h2><h3 id=\"辅助类\"><a href=\"#辅助类\" class=\"headerlink\" title=\"辅助类\"></a>辅助类</h3><p>线程类,单纯为了打印线程名.可省略</p>\n<p><strong>Threads.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">Threads</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">run</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Runnable</span><span style=\"color: #657B83\"> runnable, </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> name) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val thread </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Thread</span><span style=\"color: #657B83\">(runnable);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">thread</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">setName</span><span style=\"color: #657B83\">(name </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> </span><span style=\"color: #2AA198\">&quot;-&quot;</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">thread</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getId</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">thread</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">start</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><hr>\n<h3 id=\"本体\"><a href=\"#本体\" class=\"headerlink\" title=\"本体\"></a>本体</h3><p>框架启动入口类</p>\n<p><strong>ILauncher.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.Vertx</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.function.Consumer</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">interface</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">ILauncher</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">  /**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * 这里为什么要采用Java8的Consumer为参数,而不是Vertx或者Supplier&lt;Vertx&gt;呢.</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * 1. 这里我们希望Vert.x是子类去创建(单例、集群)Vert.x,而不是外界创建好后传进来. start(Vertx vertx); (×)</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * 2. 创建的Vert.x我们后续会用到,所以需要返回或者能使用到,</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   *    而单例、集群模式的Vert.x返回值一个Sync一个Future,用Supplier&lt;Vertx&gt;不好操作. start(Supplier&lt;Vertx&gt; fn); (×) </span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">start</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Consumer</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Vertx</span><span style=\"color: #657B83\">&gt; fn);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p><strong>ActorLauncher.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.netty.util.internal.logging.InternalLoggerFactory</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.netty.util.internal.logging.Log4J2LoggerFactory</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.Vertx</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.config.VertxConfig</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Fn</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.constant.Console</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.function.Consumer</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.spi.resolver.ResolverProvider.DISABLE_DNS_RESOLVER_PROP_NAME</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">ActorLauncher</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">ILauncher</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">start</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Consumer</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Vertx</span><span style=\"color: #657B83\">&gt; fn) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 读取Vert.x相关配置</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val config </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> Trunk.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #657B83\">VertxConfig</span><span style=\"color: #859900\">&gt;</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">VertxConfig</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val options </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">config</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">read</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 将Vert.x的日志换成Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">InternalLoggerFactory</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">setDefaultFactory</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Log4J2LoggerFactory</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">INSTANCE</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 墙,dns解析最好关掉.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">System</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getProperties</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">setProperty</span><span style=\"color: #657B83\">(DISABLE_DNS_RESOLVER_PROP_NAME, </span><span style=\"color: #2AA198\">&quot;true&quot;</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureExec</span><span style=\"color: #657B83\">(</span><span style=\"color: #859900\">!</span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isHAEnabled</span><span style=\"color: #657B83\">(),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 单例</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">SINGLE</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">toJson</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">encodePrettily</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">accept</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Vertx</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">(options));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      &#125;,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 集群</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        val manager </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getClusterManager</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">LAUNCHER</span><span style=\"color: #657B83\">, manager, </span><span style=\"color: #268BD2\">manager</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getNodeId</span><span style=\"color: #657B83\">(), </span><span style=\"color: #268BD2\">manager</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isActive</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">Vertx</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">clusteredVertx</span><span style=\"color: #657B83\">(options, ar </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">          val vertx </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">ar</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">result</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">          </span><span style=\"color: #268BD2\">fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">accept</span><span style=\"color: #657B83\">(vertx);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h3 id=\"启动入口\"><a href=\"#启动入口\" class=\"headerlink\" title=\"启动入口\"></a>启动入口</h3><p>模仿<em>Spring-boot</em> 的<em>SpringApplication.run</em>写一个.</p>\n<p><strong>VertxBootstrap.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.actor.EventloopActor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.actor.WorkerActor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit.Threads</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">VertxBootstrap</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">run</span><span style=\"color: #657B83\">() &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">VertxBootstrap</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">start</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">start</span><span style=\"color: #657B83\">() &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val launcher </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> Trunk.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #657B83\">ActorLauncher</span><span style=\"color: #859900\">&gt;</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">ActorLauncher</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">launcher</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">start</span><span style=\"color: #657B83\">(vertx </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">Threads</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">run</span><span style=\"color: #657B83\">(() </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        val master </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> Trunk.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #657B83\">EventloopActor</span><span style=\"color: #859900\">&gt;</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">EventloopActor</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">master</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">integration</span><span style=\"color: #657B83\">(vertx);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      &#125;, </span><span style=\"color: #2AA198\">&quot;ygo-eventloop-thread&quot;</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">Threads</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">run</span><span style=\"color: #657B83\">(() </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        val worker </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> Trunk.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #657B83\">WorkerActor</span><span style=\"color: #859900\">&gt;</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">WorkerActor</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">worker</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">integration</span><span style=\"color: #657B83\">(vertx);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      &#125;, </span><span style=\"color: #2AA198\">&quot;ygo-worker-thread&quot;</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><p>在 <em>&#x2F;test&#x2F;main&#x2F;resources</em> 、 <em>&#x2F;test&#x2F;main&#x2F;resources&#x2F;ygo&#x2F;</em> 目录下分别添加 <em>application.yaml</em> 文件.<br><strong>application.yaml</strong></p>\n<div class=\"language-yaml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">yaml</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #268BD2\">ygo</span><span style=\"color: #657B83\">:</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">name</span><span style=\"color: #657B83\">: </span><span style=\"color: #2AA198\">test</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">profile</span><span style=\"color: #657B83\">: </span><span style=\"color: #2AA198\">default</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">:</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">name</span><span style=\"color: #657B83\">: </span><span style=\"color: #2AA198\">vertx-ygo</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">:</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">haEnabled</span><span style=\"color: #657B83\">: </span><span style=\"color: #B58900\">false</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">preferNativeTransport</span><span style=\"color: #657B83\">: </span><span style=\"color: #B58900\">true</span></span></code></pre></div><p>启动测试类<br><strong>VertxBootstrapTest.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.junit.Test</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">VertxBootstrapTest</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Test</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">test</span><span style=\"color: #657B83\">() &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">VertxBootstrap</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">run</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p>测试结果<br><img src=\"/images/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%92%B8%E6%A1%86%E6%9E%B6/6/testret1.png\" alt=\"运行结果\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>到此框架与Vert.x基础集成完成了,现在框架中的类、配置已经被识别成<em>Verticle</em>并运行在Vert.x中了.</p>\n<p>下一篇我们就要开始集成Vert.x-web来实现框架Web部分的功能了.</p>\n","text":"这一章我们来将上一章中的 Verticle 在Vert.x中运行起来. Vert.x原始使用方式样例来自于Vert.x官网 部署Verticle并运行Vert....","permalink":"/post/从零开始撸框架(6)-与Vert.x集成 基础篇(二)","photos":[],"count_time":{"symbolsCount":"4.8k","symbolsTime":"4 mins."},"categories":[{"name":"从零开始","slug":"从零开始","count":8,"path":"api/categories/从零开始.json"}],"tags":[{"name":"Vert.x","slug":"Vert-x","count":8,"path":"api/tags/Vert-x.json"},{"name":"Actor","slug":"Actor","count":8,"path":"api/tags/Actor.json"},{"name":"设计模式","slug":"设计模式","count":8,"path":"api/tags/设计模式.json"},{"name":"Java","slug":"Java","count":9,"path":"api/tags/Java.json"},{"name":"代理模式","slug":"代理模式","count":4,"path":"api/tags/代理模式.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Vert-x%E5%8E%9F%E5%A7%8B%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">Vert.x原始使用方式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%83%A8%E7%BD%B2Verticle%E5%B9%B6%E8%BF%90%E8%A1%8CVert-x\"><span class=\"toc-text\">部署Verticle并运行Vert.x</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Vert-x%E9%9B%86%E6%88%90%E5%9F%BA%E7%B1%BB\"><span class=\"toc-text\">Vert.x集成基类</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BE%85%E5%8A%A9%E7%B1%BB\"><span class=\"toc-text\">辅助类</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%AC%E4%BD%93\"><span class=\"toc-text\">本体</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8%E5%85%A5%E5%8F%A3\"><span class=\"toc-text\">启动入口</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">测试</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li></ol>","author":{"name":"因雨而生","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"一直没脱离低级趣味的Coder","socials":{"github":"https://github.com/BornToRain","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"从零开始撸框架(7)-与Vert.x集成 Web篇(一)","uid":"c38b17588d251cd9846139dacf4f50ed","slug":"从零开始撸框架(7)-与Vert.x集成 Web篇(一)","date":"2021-05-10T06:50:32.000Z","updated":"2021-06-09T08:46:02.182Z","comments":true,"path":"api/articles/从零开始撸框架(7)-与Vert.x集成 Web篇(一).json","keywords":["Coder","Scalaer","Javaer"],"cover":"/images/vertxlogo.png","text":"上一篇讲完了与Vert.x集成的整体情况,这一篇开始与vertx-web集成. 这些内容我们主要在web模块中进行开发. Web全局集成web组件下的build...","permalink":"/post/从零开始撸框架(7)-与Vert.x集成 Web篇(一)","photos":[],"count_time":{"symbolsCount":"7.9k","symbolsTime":"7 mins."},"categories":[{"name":"从零开始","slug":"从零开始","count":8,"path":"api/categories/从零开始.json"}],"tags":[{"name":"Vert.x","slug":"Vert-x","count":8,"path":"api/tags/Vert-x.json"},{"name":"Actor","slug":"Actor","count":8,"path":"api/tags/Actor.json"},{"name":"设计模式","slug":"设计模式","count":8,"path":"api/tags/设计模式.json"},{"name":"Java","slug":"Java","count":9,"path":"api/tags/Java.json"},{"name":"代理模式","slug":"代理模式","count":4,"path":"api/tags/代理模式.json"}],"author":{"name":"因雨而生","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"一直没脱离低级趣味的Coder","socials":{"github":"https://github.com/BornToRain","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"从零开始撸框架(5)-与Vert.x集成 基础篇(一)","uid":"6b0291adc1983f086f545c1304c40edc","slug":"从零开始撸框架(5)-与Vert.x集成 基础篇(一)","date":"2021-05-07T00:27:12.000Z","updated":"2021-06-08T08:04:54.998Z","comments":true,"path":"api/articles/从零开始撸框架(5)-与Vert.x集成 基础篇(一).json","keywords":["Coder","Scalaer","Javaer"],"cover":"/images/vertxlogo.png","text":"前两章我们分别讲完了类、配置,让框架有了骨架.接下来几章我们要实现类、配置与Vert.x集成,让框架跑在Vert.x中. 由于接下来会设计到对外提供web服务了...","permalink":"/post/从零开始撸框架(5)-与Vert.x集成 基础篇(一)","photos":[],"count_time":{"symbolsCount":"16k","symbolsTime":"15 mins."},"categories":[{"name":"从零开始","slug":"从零开始","count":8,"path":"api/categories/从零开始.json"}],"tags":[{"name":"Vert.x","slug":"Vert-x","count":8,"path":"api/tags/Vert-x.json"},{"name":"Actor","slug":"Actor","count":8,"path":"api/tags/Actor.json"},{"name":"设计模式","slug":"设计模式","count":8,"path":"api/tags/设计模式.json"},{"name":"Java","slug":"Java","count":9,"path":"api/tags/Java.json"},{"name":"代理模式","slug":"代理模式","count":4,"path":"api/tags/代理模式.json"}],"author":{"name":"因雨而生","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"一直没脱离低级趣味的Coder","socials":{"github":"https://github.com/BornToRain","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}