{"title":"从零开始撸框架(5)-与Vert.x集成 基础篇(一)","uid":"6b0291adc1983f086f545c1304c40edc","slug":"从零开始撸框架(5)-与Vert.x集成 基础篇(一)","date":"2021-05-07T00:27:12.000Z","updated":"2021-06-08T08:04:54.998Z","comments":true,"path":"api/articles/从零开始撸框架(5)-与Vert.x集成 基础篇(一).json","keywords":["Coder","Scalaer","Javaer"],"cover":"/images/vertxlogo.png","content":"<p>前两章我们分别讲完了类、配置,让框架有了骨架.接下来几章我们要实现类、配置与Vert.x集成,让框架跑在Vert.x中.</p>\n<p>由于接下来会设计到对外提供web服务了,篇幅会比较长.这里我决定分篇,第一篇先把大体的讲完,剩下几篇再讲web方面的细节.</p>\n<h2 id=\"Vert-x原始使用方式\"><a href=\"#Vert-x原始使用方式\" class=\"headerlink\" title=\"Vert.x原始使用方式\"></a>Vert.x原始使用方式</h2><p>样例来自于<a href=\"https://vertx.io/\">Vert.x官网</a></p>\n<h3 id=\"编写Verticle\"><a href=\"#编写Verticle\" class=\"headerlink\" title=\"编写Verticle\"></a>编写Verticle</h3><div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.AbstractVerticle</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">Server</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">extends</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">AbstractVerticle</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">start</span><span style=\"color: #657B83\">() &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">createHttpServer</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">requestHandler</span><span style=\"color: #657B83\">(req </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">response</span><span style=\"color: #657B83\">()</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        .</span><span style=\"color: #268BD2\">putHeader</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;content-type&quot;</span><span style=\"color: #657B83\">, </span><span style=\"color: #2AA198\">&quot;text/plain&quot;</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        .</span><span style=\"color: #268BD2\">end</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;Hello from Vert.x!&quot;</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;).</span><span style=\"color: #268BD2\">listen</span><span style=\"color: #657B83\">(</span><span style=\"color: #D33682\">8080</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p>这里贴出来方便参考,下面开始与Vert.x的集成.</p>\n<hr>\n<h2 id=\"Vert-x集成基类\"><a href=\"#Vert-x集成基类\" class=\"headerlink\" title=\"Vert.x集成基类\"></a>Vert.x集成基类</h2><h3 id=\"辅助类\"><a href=\"#辅助类\" class=\"headerlink\" title=\"辅助类\"></a>辅助类</h3><h4 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h4><p>集成中,不管是 <em>Eventloop</em> 还是 <em>Worker</em> 都会用到一些重复的方法,只是部分参数不同,我们把它做成工具类.<br><strong>Verticles.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.DeploymentOptions</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.Vertx</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.eventbus.DeliveryOptions</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Console</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Const</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.HashMap</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Map</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Objects</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * Vert.x Vertcile部署</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">Verticles</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// value - verticle id</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;, </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">VERTICLES</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">flag</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">boolean</span><span style=\"color: #657B83\"> isWorker) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> isWorker </span><span style=\"color: #859900\">?</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">WORKER</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">:</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">EVENTLOOP</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">deploy</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Vertx</span><span style=\"color: #657B83\"> vertx, </span><span style=\"color: #586E75; font-weight: bold\">DeploymentOptions</span><span style=\"color: #657B83\"> options, </span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; cls) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val name </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">cls</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getName</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val flag </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">flag</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isWorker</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">deployVerticle</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">cls</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getName</span><span style=\"color: #657B83\">(), options, ar </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val id </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">ar</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">result</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val instances </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getInstances</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #268BD2\">ar</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">succeeded</span><span style=\"color: #657B83\">()) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">DEPLOYED_S</span><span style=\"color: #657B83\">, flag, name, instances, id);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">VERTICLES</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">put</span><span style=\"color: #657B83\">(cls, id);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">else</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        val cause </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">ar</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">cause</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">nonNull</span><span style=\"color: #657B83\">(cause)) </span><span style=\"color: #268BD2\">cause</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">printStackTrace</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        val msg </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isNull</span><span style=\"color: #657B83\">(cause) </span><span style=\"color: #859900\">?</span><span style=\"color: #657B83\"> </span><span style=\"color: #B58900\">null</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">:</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">cause</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getMessage</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">warn</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">DEPLOYED_F</span><span style=\"color: #657B83\">, flag, name, id, instances, msg);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">undeploy</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Vertx</span><span style=\"color: #657B83\"> vertx, </span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; cls, </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> flag) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val id </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">VERTICLES</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(cls);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val name </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">cls</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getName</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">undeploy</span><span style=\"color: #657B83\">(id, ar </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #268BD2\">ar</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">succeeded</span><span style=\"color: #657B83\">()) </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">UNDEPLOYED_S</span><span style=\"color: #657B83\">, flag, name, id);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">else</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        val cause </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">ar</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">cause</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">nonNull</span><span style=\"color: #657B83\">(cause)) </span><span style=\"color: #268BD2\">cause</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">printStackTrace</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        val msg </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isNull</span><span style=\"color: #657B83\">(cause) </span><span style=\"color: #859900\">?</span><span style=\"color: #657B83\"> </span><span style=\"color: #B58900\">null</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">:</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">cause</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getMessage</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">warn</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">UNDEPLOYED_F</span><span style=\"color: #657B83\">, flag, name, id, msg);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">DeliveryOptions</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">delivery</span><span style=\"color: #657B83\">() &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">DeliveryOptions</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h4 id=\"类、配置\"><a href=\"#类、配置\" class=\"headerlink\" title=\"类、配置\"></a>类、配置</h4><p>当然也会用到我们之前加载好的类、配置.<br><strong>Trunk.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">Trunk</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  ...</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 所有@Eventloop类</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Set</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;&gt; </span><span style=\"color: #268BD2\">EVENTLOOPS</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashSet</span><span style=\"color: #657B83\">&lt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 所有@Worker类</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Set</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;&gt; </span><span style=\"color: #268BD2\">WORKERS</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashSet</span><span style=\"color: #657B83\">&lt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 所有Vert.x EventBus上的对象</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Set</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Receipt</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">RECEIPTS</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashSet</span><span style=\"color: #657B83\">&lt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  ...</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p><strong>Deck.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">Deck</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  ...</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 所有http服务配置</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Integer</span><span style=\"color: #657B83\">, </span><span style=\"color: #586E75; font-weight: bold\">Server</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">HTTP_SERVERS</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 所有tcp服务配置</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Integer</span><span style=\"color: #657B83\">, </span><span style=\"color: #586E75; font-weight: bold\">Server</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">NET_SERVERS</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  ...</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p><strong>Reflect.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">Reflect</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  ...</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;, </span><span style=\"color: #586E75; font-weight: bold\">MethodAccess</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">METHODS</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 反射执行对应的方法</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> &lt;</span><span style=\"color: #586E75; font-weight: bold\">T</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #586E75; font-weight: bold\">T</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">invokeMethod</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\"> instance, </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> name, </span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\">... args) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureRun</span><span style=\"color: #657B83\">(() </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val instanceCls </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">instance</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getClass</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val access </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">pool</span><span style=\"color: #657B83\">(METHODS, instanceCls, () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">MethodAccess</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(instanceCls));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> (T) </span><span style=\"color: #268BD2\">access</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">invoke</span><span style=\"color: #657B83\">(instance, name, args);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;, instance, name);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h3 id=\"本体\"><a href=\"#本体\" class=\"headerlink\" title=\"本体\"></a>本体</h3><p>IActor是框架与Vert.x的连接桥梁,子类继承该类就可以获得Vert.x框架中的Vert.x对象.</p>\n<p><strong>IActor.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.actor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.Vertx</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">interface</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">IActor</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">integration</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Vertx</span><span style=\"color: #657B83\"> vertx);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p>Vert.x中最小工作单位Verticle为一个类,它的配置参数<em>io.vertx.core.DeploymentOptions</em>就是根据该类获取的,这里我们可以得出一个Verticle配置参数提取基类.</p>\n<p><strong>IExtractor.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.actor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.DeploymentOptions</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 根据类名获取相应的配置</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">interface</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">IExtractor</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">DeploymentOptions</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">extract</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; cls);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p>Vert.x通信是通过eventbus交互的,这里我们也抽象出一个基类,后续可以实现异步(Future)、同步(Sync)、响应式(Rx)应答,当前我们仅实现Future.</p>\n<p><strong>IReplier.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.actor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.Future</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.eventbus.Message</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.lang.reflect.Method</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.HashMap</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Map</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">interface</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">IReplier</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 定义一个map,用于表驱动选取对应的应答模式,默认是Future.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;, </span><span style=\"color: #586E75; font-weight: bold\">IReplier</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">MAP</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;() &lt;</span><span style=\"color: #859900\">!--</span><span style=\"color: #657B83\">swig￼</span><span style=\"color: #D33682\">0</span><span style=\"color: #859900\">--&gt;</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">IReplier</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; key) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">MAP</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getOrDefault</span><span style=\"color: #657B83\">(key, </span><span style=\"color: #268BD2\">Trunk</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">FutureReplier</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">reply</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\"> proxy, </span><span style=\"color: #586E75; font-weight: bold\">Method</span><span style=\"color: #657B83\"> method, </span><span style=\"color: #586E75; font-weight: bold\">Message</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\">&gt; message);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p><strong>FutureReplier.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.actor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.Future</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.eventbus.Message</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Console</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Reflect</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Verticles</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.lang.reflect.Method</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">FutureReplier</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">IReplier</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">reply</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\"> proxy, </span><span style=\"color: #586E75; font-weight: bold\">Method</span><span style=\"color: #657B83\"> method, </span><span style=\"color: #586E75; font-weight: bold\">Message</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\">&gt; message) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 因为是Future响应,返回值的形式是Future&lt;?&gt;,光靠method.getReturnType()是拿不到具体泛型的.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val retType </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getGenericReturnType</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">REPLY</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">getClass</span><span style=\"color: #657B83\">(), retType, </span><span style=\"color: #B58900\">false</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 反射执行方法</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    Reflect.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Future</span><span style=\"color: #859900\">&lt;?&gt;&gt;</span><span style=\"color: #268BD2\">invokeMethod</span><span style=\"color: #657B83\">(proxy, </span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getName</span><span style=\"color: #657B83\">(), message)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 执行完成,开始应答.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">onComplete</span><span style=\"color: #657B83\">(ar </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">message</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">reply</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">ar</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">result</span><span style=\"color: #657B83\">(), </span><span style=\"color: #268BD2\">Verticles</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">delivery</span><span style=\"color: #657B83\">()));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><hr>\n<h2 id=\"Eventloop集成\"><a href=\"#Eventloop集成\" class=\"headerlink\" title=\"Eventloop集成\"></a>Eventloop集成</h2><h3 id=\"本体-1\"><a href=\"#本体-1\" class=\"headerlink\" title=\"本体\"></a>本体</h3><p><strong>EventloopExtractor.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.actor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.DeploymentOptions</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.annotations.Eventloop</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Console</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Const</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Fn</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.HashMap</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Map</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * Eventloop类的Verticle参数提取</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">EventloopExtractor</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">IExtractor</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;, </span><span style=\"color: #586E75; font-weight: bold\">DeploymentOptions</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">OPTIONS</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">DeploymentOptions</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">extract</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; cls) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">DEPLOY</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">EVENTLOOP</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">cls</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getName</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">pool</span><span style=\"color: #657B83\">(OPTIONS, cls, () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">extractValue</span><span style=\"color: #657B83\">(cls));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">DeploymentOptions</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">extractValue</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; cls) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val anno </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">cls</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAnnotation</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Eventloop</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val options </span><span style=\"color: #859900\">=</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">DeploymentOptions</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">setHa</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">anno</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ha</span><span style=\"color: #657B83\">()).</span><span style=\"color: #268BD2\">setInstances</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">anno</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">instances</span><span style=\"color: #657B83\">()).</span><span style=\"color: #268BD2\">setWorker</span><span style=\"color: #657B83\">(</span><span style=\"color: #B58900\">false</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #859900\">!</span><span style=\"color: #268BD2\">OPTIONS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isEmpty</span><span style=\"color: #657B83\">()) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val latest </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">OPTIONS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getOrDefault</span><span style=\"color: #657B83\">(cls, </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">DeploymentOptions</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val oldest </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">toJson</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">oldest</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">mergeIn</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">latest</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">toJson</span><span style=\"color: #657B83\">(), </span><span style=\"color: #B58900\">true</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">DeploymentOptions</span><span style=\"color: #657B83\">(oldest);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">DEPLOYED</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">EVENTLOOP</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getInstances</span><span style=\"color: #657B83\">(), </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isHa</span><span style=\"color: #657B83\">(),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">toJson</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> options;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p><strong>EventloopActor.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.actor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.Vertx</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Const</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.EventloopType</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Verticles</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.HashMap</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Map</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * eventloop集合与Vert.x集成</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">EventloopActor</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">IActor</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 这里定义一个集合,因为eventloop目前总共有三类, http、tcp、sock.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">EventloopType</span><span style=\"color: #657B83\">, </span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;&gt; </span><span style=\"color: #268BD2\">EVENTLOOPS</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">integration</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Vertx</span><span style=\"color: #657B83\"> vertx) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 配置提取器</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val extractor </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> Trunk.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #657B83\">EventloopExtractor</span><span style=\"color: #859900\">&gt;</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">EventloopExtractor</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 循环作为Verticle部署到Vert.x中</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">EVENTLOOPS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">forEach</span><span style=\"color: #657B83\">((type, cls) </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Verticles</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">deploy</span><span style=\"color: #657B83\">(vertx, </span><span style=\"color: #268BD2\">extractor</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">extract</span><span style=\"color: #657B83\">(cls), cls));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 钩子,优雅从Vert.x中卸载对应的Verticle.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Runtime</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getRuntime</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">addShutdownHook</span><span style=\"color: #657B83\">(</span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Thread</span><span style=\"color: #657B83\">(</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">EVENTLOOPS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">forEach</span><span style=\"color: #657B83\">((type, cls) </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Verticles</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">undeploy</span><span style=\"color: #657B83\">(vertx, cls, </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">EVENTLOOP</span><span style=\"color: #657B83\">))));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p><em>Eventloop</em>类型分为<em>http</em>、<em>tcp</em>、<em>sock</em>分类,这里我们实现一个<em>http</em>.</p>\n<h3 id=\"http实现\"><a href=\"#http实现\" class=\"headerlink\" title=\"http实现\"></a>http实现</h3><p>http我们只实现任务调度部分.</p>\n<p>http非<em>vertx-core</em>内容,这里我们新建一个<em>web</em>模块,接下来web方面内容都在该模块下写.</p>\n<p><strong>build.gradle(web模块下)</strong></p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #657B83\">dependencies &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  // 依赖核心组件</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  compile project(&quot;:core&quot;)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  // 追加vertx-web</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  compile &quot;io.vertx:vertx-web:$vertxVersion&quot;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h4 id=\"http配置\"><a href=\"#http配置\" class=\"headerlink\" title=\"http配置\"></a>http配置</h4><p>新建两个Java文件,一个是配置对象,一个是继承自前两章的<em>IConfig</em>接口来实现配置读取.</p>\n<h5 id=\"配置对象\"><a href=\"#配置对象\" class=\"headerlink\" title=\"配置对象\"></a>配置对象</h5><p><strong>Server.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.config</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.json.JsonObject</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.AccessLevel</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.Data</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.experimental.Accessors</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.experimental.FieldDefaults</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Data</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Accessors</span><span style=\"color: #657B83\">(</span><span style=\"color: #CB4B16\">chain</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #B58900\">true</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">FieldDefaults</span><span style=\"color: #657B83\">(</span><span style=\"color: #CB4B16\">level</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">AccessLevel</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">PRIVATE</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">Server</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// HttpServerOptions NetServerOptions</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">JsonObject</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">type</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">name</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h5 id=\"配置读取\"><a href=\"#配置读取\" class=\"headerlink\" title=\"配置读取\"></a>配置读取</h5><p><strong>ServerConfig.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.config</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.json.JsonArray</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.json.JsonObject</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.config.IConfig</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.config.YgoConfig</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Const</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.HashMap</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Map</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 从配置文件中读取Web服务配置</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">ServerConfig</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">IConfig</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Integer</span><span style=\"color: #657B83\">, </span><span style=\"color: #586E75; font-weight: bold\">Server</span><span style=\"color: #657B83\">&gt;&gt; &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Integer</span><span style=\"color: #657B83\">, </span><span style=\"color: #586E75; font-weight: bold\">Server</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">read</span><span style=\"color: #657B83\">() &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val config </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> Trunk.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #657B83\">YgoConfig</span><span style=\"color: #859900\">&gt;</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">YgoConfig</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">read</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">read</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">config</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getJsonObject</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">VERTX</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">getJsonArray</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">SERVER</span><span style=\"color: #657B83\">));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 根据端口分组</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Integer</span><span style=\"color: #657B83\">, </span><span style=\"color: #586E75; font-weight: bold\">Server</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">read</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">JsonArray</span><span style=\"color: #657B83\"> xs) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val map </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Integer</span><span style=\"color: #657B83\">, </span><span style=\"color: #586E75; font-weight: bold\">Server</span><span style=\"color: #657B83\">&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">xs</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">forEach</span><span style=\"color: #657B83\">(d </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val json </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">JsonObject</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">mapFrom</span><span style=\"color: #657B83\">(d);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val options </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">json</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getJsonObject</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">OPTIONS</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val port </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getInteger</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">PORT</span><span style=\"color: #657B83\">, </span><span style=\"color: #D33682\">8080</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val value </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Server</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">setName</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">json</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getString</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;name&quot;</span><span style=\"color: #657B83\">)).</span><span style=\"color: #268BD2\">setType</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">json</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getString</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;type&quot;</span><span style=\"color: #657B83\">))</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        .</span><span style=\"color: #268BD2\">setOptions</span><span style=\"color: #657B83\">(options);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">map</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">put</span><span style=\"color: #657B83\">(port, value);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> map;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h5 id=\"配置示例\"><a href=\"#配置示例\" class=\"headerlink\" title=\"配置示例\"></a>配置示例</h5><p><strong>application.yaml</strong></p>\n<div class=\"language-yaml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">yaml</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">#### 配置示例</span></span>\n<span class=\"line\"><span style=\"color: #268BD2\">ygo</span><span style=\"color: #657B83\">:</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">profile</span><span style=\"color: #657B83\">: </span><span style=\"color: #2AA198\">default</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">:</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">name</span><span style=\"color: #657B83\">: </span><span style=\"color: #2AA198\">vertx-ygo</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">:</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">haEnabled</span><span style=\"color: #657B83\">: </span><span style=\"color: #B58900\">false</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">preferNativeTransport</span><span style=\"color: #657B83\">: </span><span style=\"color: #B58900\">true</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">server</span><span style=\"color: #657B83\">:</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      - </span><span style=\"color: #268BD2\">name</span><span style=\"color: #657B83\">: </span><span style=\"color: #2AA198\">default-port</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">type</span><span style=\"color: #657B83\">: </span><span style=\"color: #2AA198\">http</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">:</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">          </span><span style=\"color: #268BD2\">host</span><span style=\"color: #657B83\">: </span><span style=\"color: #D33682\">0.0.0.0</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">          </span><span style=\"color: #268BD2\">port</span><span style=\"color: #657B83\">: </span><span style=\"color: #D33682\">8080</span></span></code></pre></div><h4 id=\"http本体\"><a href=\"#http本体\" class=\"headerlink\" title=\"http本体\"></a>http本体</h4><p><strong>EventloopHttpActor.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.actor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.AbstractVerticle</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.http.HttpServerOptions</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.Router</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.annotations.Eventloop</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Const</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.config.Server</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.constant.Console</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit.Deck</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit.Network</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * eventloop的http实现</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Eventloop</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">EventloopHttpActor</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">extends</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">AbstractVerticle</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">start</span><span style=\"color: #657B83\">() </span><span style=\"color: #586E75; font-weight: bold\">throws</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Exception</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// http服务集合</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Deck</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">HTTP_SERVERS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">forEach</span><span style=\"color: #657B83\">((port, config) </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 获取路由</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val router </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Router</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">router</span><span style=\"color: #657B83\">(vertx);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">server</span><span style=\"color: #657B83\">(router, port, config);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 发布http服务</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">server</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Router</span><span style=\"color: #657B83\"> router, </span><span style=\"color: #586E75; font-weight: bold\">Integer</span><span style=\"color: #657B83\"> port, </span><span style=\"color: #586E75; font-weight: bold\">Server</span><span style=\"color: #657B83\"> config) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val options </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">HttpServerOptions</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">config</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getOptions</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">createHttpServer</span><span style=\"color: #657B83\">(options).</span><span style=\"color: #268BD2\">requestHandler</span><span style=\"color: #657B83\">(router).</span><span style=\"color: #268BD2\">listen</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 发布api地址</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val path </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #2AA198\">&quot;http://&quot;</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Network</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getIPv4</span><span style=\"color: #657B83\">() </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">COLON</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> port </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">SLASH</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">SERVER</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">getClass</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">getSimpleName</span><span style=\"color: #657B83\">(), </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">HTTP</span><span style=\"color: #657B83\">, path);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><hr>\n<h2 id=\"Worker集成\"><a href=\"#Worker集成\" class=\"headerlink\" title=\"Worker集成\"></a>Worker集成</h2><h3 id=\"本体-2\"><a href=\"#本体-2\" class=\"headerlink\" title=\"本体\"></a>本体</h3><p>这一块同<em>Eventloop</em>部分,不多赘述.</p>\n<p><strong>WorkerExtractor.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.actor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.DeploymentOptions</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.annotations.Worker</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Console</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Const</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Fn</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.HashMap</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Map</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">WorkerExtractor</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">IExtractor</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;, </span><span style=\"color: #586E75; font-weight: bold\">DeploymentOptions</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">OPTIONS</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">DeploymentOptions</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">extract</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; cls) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">DEPLOY</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">WORKER</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">cls</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getName</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">pool</span><span style=\"color: #657B83\">(OPTIONS, cls, () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">extractValue</span><span style=\"color: #657B83\">(cls));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">DeploymentOptions</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">extractValue</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; cls) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val anno </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">cls</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAnnotation</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Worker</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val options </span><span style=\"color: #859900\">=</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">DeploymentOptions</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">setHa</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">anno</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ha</span><span style=\"color: #657B83\">()).</span><span style=\"color: #268BD2\">setInstances</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">anno</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">instances</span><span style=\"color: #657B83\">()).</span><span style=\"color: #268BD2\">setWorker</span><span style=\"color: #657B83\">(</span><span style=\"color: #B58900\">true</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #859900\">!</span><span style=\"color: #268BD2\">OPTIONS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isEmpty</span><span style=\"color: #657B83\">()) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val latest </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">OPTIONS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getOrDefault</span><span style=\"color: #657B83\">(cls, </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">DeploymentOptions</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val oldest </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">toJson</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">oldest</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">mergeIn</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">latest</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">toJson</span><span style=\"color: #657B83\">(), </span><span style=\"color: #B58900\">true</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">DeploymentOptions</span><span style=\"color: #657B83\">(oldest);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">DEPLOYED</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">WORKER</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getInstances</span><span style=\"color: #657B83\">(), </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isHa</span><span style=\"color: #657B83\">(), </span><span style=\"color: #268BD2\">options</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">toJson</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> options;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p><strong>WorkerActor.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.actor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.Vertx</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Const</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Verticles</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">WorkerActor</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">IActor</span><span style=\"color: #657B83\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">integration</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Vertx</span><span style=\"color: #657B83\"> vertx) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val extractor </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> Trunk.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #657B83\">WorkerExtractor</span><span style=\"color: #859900\">&gt;</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">WorkerExtractor</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Trunk</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">WORKERS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">forEach</span><span style=\"color: #657B83\">(cls </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Verticles</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">deploy</span><span style=\"color: #657B83\">(vertx, </span><span style=\"color: #268BD2\">extractor</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">extract</span><span style=\"color: #657B83\">(cls), cls));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Runtime</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getRuntime</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">addShutdownHook</span><span style=\"color: #657B83\">(</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Thread</span><span style=\"color: #657B83\">(() </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Trunk</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">WORKERS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">forEach</span><span style=\"color: #657B83\">(cls </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Verticles</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">undeploy</span><span style=\"color: #657B83\">(vertx, cls, </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">WORKER</span><span style=\"color: #657B83\">))));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h3 id=\"http实现-1\"><a href=\"#http实现-1\" class=\"headerlink\" title=\"http实现\"></a>http实现</h3><p>http的请求调度<em>eventloop</em>已经实现,这里我们只需要实现http的请求处理.</p>\n<h4 id=\"http本体-1\"><a href=\"#http本体-1\" class=\"headerlink\" title=\"http本体\"></a>http本体</h4><p><strong>WorkerHttpActor.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.actor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.AbstractVerticle</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.actor.IReplier</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.annotations.Worker</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Worker</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">WorkerHttpActor</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">extends</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">AbstractVerticle</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">start</span><span style=\"color: #657B83\">() </span><span style=\"color: #586E75; font-weight: bold\">throws</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Exception</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 所有的Vert.x消息</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Trunk</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">RECEIPTS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">forEach</span><span style=\"color: #657B83\">(data </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val method </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">data</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getMethod</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 根据返回值类型,Future Object决定应答模式.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val replier </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">IReplier</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getReturnType</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// Vert.x EventBus上根据地址开始消费消息并响应.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">eventBus</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">consumer</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">data</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAddr</span><span style=\"color: #657B83\">(), msg </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">replier</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">reply</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">data</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getProxy</span><span style=\"color: #657B83\">(), method, msg));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><hr>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>这一章我们大体上实现了<em>Eventloop</em>、<em>Worker</em>类、配置与Vert.x的集成,让这些玩意转成Vert.x能看懂的<em>Verticle</em>.</p>\n","text":"前两章我们分别讲完了类、配置,让框架有了骨架.接下来几章我们要实现类、配置与Vert.x集成,让框架跑在Vert.x中. 由于接下来会设计到对外提供web服务了...","permalink":"/post/从零开始撸框架(5)-与Vert.x集成 基础篇(一)","photos":[],"count_time":{"symbolsCount":"16k","symbolsTime":"15 mins."},"categories":[{"name":"从零开始","slug":"从零开始","count":8,"path":"api/categories/从零开始.json"}],"tags":[{"name":"Vert.x","slug":"Vert-x","count":8,"path":"api/tags/Vert-x.json"},{"name":"Actor","slug":"Actor","count":8,"path":"api/tags/Actor.json"},{"name":"设计模式","slug":"设计模式","count":8,"path":"api/tags/设计模式.json"},{"name":"Java","slug":"Java","count":9,"path":"api/tags/Java.json"},{"name":"代理模式","slug":"代理模式","count":4,"path":"api/tags/代理模式.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Vert-x%E5%8E%9F%E5%A7%8B%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">Vert.x原始使用方式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BC%96%E5%86%99Verticle\"><span class=\"toc-text\">编写Verticle</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Vert-x%E9%9B%86%E6%88%90%E5%9F%BA%E7%B1%BB\"><span class=\"toc-text\">Vert.x集成基类</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BE%85%E5%8A%A9%E7%B1%BB\"><span class=\"toc-text\">辅助类</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%B7%A5%E5%85%B7\"><span class=\"toc-text\">工具</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%B1%BB%E3%80%81%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">类、配置</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%AC%E4%BD%93\"><span class=\"toc-text\">本体</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Eventloop%E9%9B%86%E6%88%90\"><span class=\"toc-text\">Eventloop集成</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%AC%E4%BD%93-1\"><span class=\"toc-text\">本体</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#http%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">http实现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#http%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">http配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E5%AF%B9%E8%B1%A1\"><span class=\"toc-text\">配置对象</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E8%AF%BB%E5%8F%96\"><span class=\"toc-text\">配置读取</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\">配置示例</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#http%E6%9C%AC%E4%BD%93\"><span class=\"toc-text\">http本体</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Worker%E9%9B%86%E6%88%90\"><span class=\"toc-text\">Worker集成</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%AC%E4%BD%93-2\"><span class=\"toc-text\">本体</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#http%E5%AE%9E%E7%8E%B0-1\"><span class=\"toc-text\">http实现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#http%E6%9C%AC%E4%BD%93-1\"><span class=\"toc-text\">http本体</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li></ol>","author":{"name":"因雨而生","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"一直没脱离低级趣味的Coder","socials":{"github":"https://github.com/BornToRain","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"从零开始撸框架(6)-与Vert.x集成 基础篇(二)","uid":"a0a429763c9944ec54d86de5e0e4f445","slug":"从零开始撸框架(6)-与Vert.x集成 基础篇(二)","date":"2021-05-07T03:54:00.000Z","updated":"2021-05-10T10:02:35.468Z","comments":true,"path":"api/articles/从零开始撸框架(6)-与Vert.x集成 基础篇(二).json","keywords":["Coder","Scalaer","Javaer"],"cover":"/images/vertxlogo.png","text":"这一章我们来将上一章中的 Verticle 在Vert.x中运行起来. Vert.x原始使用方式样例来自于Vert.x官网 部署Verticle并运行Vert....","permalink":"/post/从零开始撸框架(6)-与Vert.x集成 基础篇(二)","photos":[],"count_time":{"symbolsCount":"4.8k","symbolsTime":"4 mins."},"categories":[{"name":"从零开始","slug":"从零开始","count":8,"path":"api/categories/从零开始.json"}],"tags":[{"name":"Vert.x","slug":"Vert-x","count":8,"path":"api/tags/Vert-x.json"},{"name":"Actor","slug":"Actor","count":8,"path":"api/tags/Actor.json"},{"name":"设计模式","slug":"设计模式","count":8,"path":"api/tags/设计模式.json"},{"name":"Java","slug":"Java","count":9,"path":"api/tags/Java.json"},{"name":"代理模式","slug":"代理模式","count":4,"path":"api/tags/代理模式.json"}],"author":{"name":"因雨而生","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"一直没脱离低级趣味的Coder","socials":{"github":"https://github.com/BornToRain","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"从零开始撸框架(4)-配置读取器","uid":"45dcae5ccfe9e8f63cc7cbe584bb9d7a","slug":"从零开始撸框架(4)-配置读取器","date":"2021-05-01T22:43:37.000Z","updated":"2021-05-07T01:21:36.962Z","comments":true,"path":"api/articles/从零开始撸框架(4)-配置读取器.json","keywords":["Coder","Scalaer","Javaer"],"cover":"/images/vertxlogo.png","text":"到目前为止,框架已经支持了 工厂 、 Bean分组 、 依赖注入 ,这一章我们来实现框架配置的读取. 配置读取基类老样子,我们还是先定义一个读取基类,方便后续子...","permalink":"/post/从零开始撸框架(4)-配置读取器","photos":[],"count_time":{"symbolsCount":"7.9k","symbolsTime":"7 mins."},"categories":[{"name":"从零开始","slug":"从零开始","count":8,"path":"api/categories/从零开始.json"}],"tags":[{"name":"Vert.x","slug":"Vert-x","count":8,"path":"api/tags/Vert-x.json"},{"name":"Actor","slug":"Actor","count":8,"path":"api/tags/Actor.json"},{"name":"设计模式","slug":"设计模式","count":8,"path":"api/tags/设计模式.json"},{"name":"Java","slug":"Java","count":9,"path":"api/tags/Java.json"}],"author":{"name":"因雨而生","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"一直没脱离低级趣味的Coder","socials":{"github":"https://github.com/BornToRain","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}