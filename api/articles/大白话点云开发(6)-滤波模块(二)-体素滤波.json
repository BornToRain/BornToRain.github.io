{"title":"大白话点云开发(6)-滤波模块(二)-体素滤波","uid":"49f957c8c30227fbffa72516e70c6410","slug":"大白话点云开发(6)-滤波模块(二)-体素滤波","date":"2024-03-28T17:31:12.000Z","updated":"2024-03-28T18:59:16.641Z","comments":true,"path":"api/articles/大白话点云开发(6)-滤波模块(二)-体素滤波.json","keywords":["Coder","Scalaer","Javaer"],"cover":"/images/ros2logo.png","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>体素滤波: 大白话就是降低分辨率从而减少点云大小.</p>\n<hr>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><h3 id=\"算法参数\"><a href=\"#算法参数\" class=\"headerlink\" title=\"算法参数\"></a>算法参数</h3><p>体素滤波共有四个核心参数</p>\n<ul>\n<li>1: leaf_size_x</li>\n<li>2: leaf_size_y</li>\n<li>3: leaf_size_z</li>\n<li>4: min_points_per_voxel</li>\n</ul>\n<p>xyz会组成一个三维立方体(体素网格),min_points_per_voxel代表着每1个体素内需要包含的最小点个数.</p>\n<p>知道算法参数后我们在 <em>filter_params.hpp</em> 添加上</p>\n<p><strong>filter_params.hpp</strong></p>\n<div class=\"language-cpp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">cpp</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">struct</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">FilterParams</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  ...</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> voxel_grid_x;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> voxel_grid_y;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> voxel_grid_z;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">int</span><span style=\"color: #657B83\"> voxel_grid_min_pt_num;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  ...</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;;</span></span></code></pre></div><h3 id=\"算法实现\"><a href=\"#算法实现\" class=\"headerlink\" title=\"算法实现\"></a>算法实现</h3><p>考虑到实际使用中会有实时和离线两种场景,这两种场景下算法的参数并不相同.</p>\n<ul>\n<li>实时下会频繁调用体素滤波,需要把滤波器指针保存复用.</li>\n<li>离线下调用不频繁,可以不传如滤波器指针,内部创建即用即毁.</li>\n</ul>\n<p>首先我们在 <em>filter.hpp</em> 中定义函数</p>\n<p><strong>filter.hpp</strong></p>\n<div class=\"language-cpp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">cpp</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">// 体素滤波</span></span>\n<span class=\"line\"><span style=\"color: #859900\">#include</span><span style=\"color: #B58900\"> </span><span style=\"color: #2AA198\">&lt;pcl/filters/voxel_grid.h&gt;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">#include</span><span style=\"color: #B58900\"> </span><span style=\"color: #2AA198\">&quot;pcr/common/pcl_types.hpp&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">namespace</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcr</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">namespace</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">filter</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">... </span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">template</span><span style=\"color: #657B83\"> &lt;</span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">input,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">filter);</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">template</span><span style=\"color: #657B83\"> &lt;</span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">input, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> x, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> y,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> z, </span><span style=\"color: #586E75; font-weight: bold\">int</span><span style=\"color: #657B83\"> min_pt_num);</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #586E75; font-weight: bold\">@brief</span><span style=\"color: #93A1A1; font-style: italic\"> 体素滤波</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> *</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #586E75; font-weight: bold\">@tparam</span><span style=\"color: #93A1A1; font-style: italic\"> A</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #586E75; font-weight: bold\">@param</span><span style=\"color: #93A1A1; font-style: italic\">[</span><span style=\"color: #859900; font-style: italic\">in</span><span style=\"color: #93A1A1; font-style: italic\">] input 点云指针</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #586E75; font-weight: bold\">@param</span><span style=\"color: #93A1A1; font-style: italic\">[</span><span style=\"color: #859900; font-style: italic\">in</span><span style=\"color: #93A1A1; font-style: italic\">] filter 滤波器指针</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #586E75; font-weight: bold\">@param</span><span style=\"color: #93A1A1; font-style: italic\">[</span><span style=\"color: #859900; font-style: italic\">in</span><span style=\"color: #93A1A1; font-style: italic\">] x</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #586E75; font-weight: bold\">@param</span><span style=\"color: #93A1A1; font-style: italic\">[</span><span style=\"color: #859900; font-style: italic\">in</span><span style=\"color: #93A1A1; font-style: italic\">] y</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #586E75; font-weight: bold\">@param</span><span style=\"color: #93A1A1; font-style: italic\">[</span><span style=\"color: #859900; font-style: italic\">in</span><span style=\"color: #93A1A1; font-style: italic\">] z</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #586E75; font-weight: bold\">@param</span><span style=\"color: #93A1A1; font-style: italic\">[</span><span style=\"color: #859900; font-style: italic\">in</span><span style=\"color: #93A1A1; font-style: italic\">] min_pt_num 每1个体素内需要包含的最小点个数</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #586E75; font-weight: bold\">@param</span><span style=\"color: #93A1A1; font-style: italic\">[</span><span style=\"color: #859900; font-style: italic\">out</span><span style=\"color: #93A1A1; font-style: italic\">] output 输出点云指针</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">template</span><span style=\"color: #657B83\"> &lt;</span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">input,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">filter, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> x, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> y,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> z, </span><span style=\"color: #586E75; font-weight: bold\">int</span><span style=\"color: #657B83\"> min_pt_num,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">output);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">...</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span><span style=\"color: #93A1A1; font-style: italic\"> // namespace filter</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span><span style=\"color: #93A1A1; font-style: italic\"> // namespace pcr</span></span></code></pre></div><p>在 <em>filter.cpp</em> 中实现</p>\n<p><strong>filter.cpp</strong></p>\n<div class=\"language-cpp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">cpp</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">#include</span><span style=\"color: #B58900\"> </span><span style=\"color: #2AA198\">&quot;pcr/filter/filter.hpp&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">#include</span><span style=\"color: #B58900\"> </span><span style=\"color: #2AA198\">&quot;pcr/filter/filter_params.hpp&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">namespace</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcr</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">namespace</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">filter</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">...</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">template</span><span style=\"color: #657B83\"> &lt;</span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">input,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">filter) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  FilterParams </span><span style=\"color: #859900\">&amp;</span><span style=\"color: #657B83\">filter_params </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">FilterParams</span><span style=\"color: #657B83\">::</span><span style=\"color: #268BD2\">getInstance</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;(input, filter, </span><span style=\"color: #268BD2\">filter_params</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">voxel_grid_x</span><span style=\"color: #657B83\">,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #268BD2\">filter_params</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">voxel_grid_y</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">filter_params</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">voxel_grid_z</span><span style=\"color: #657B83\">,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #268BD2\">filter_params</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">voxel_grid_min_pt_num</span><span style=\"color: #657B83\">, input);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">template</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span></span>\n<span class=\"line\"><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;(</span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">&amp;</span><span style=\"color: #657B83\">input,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">                  </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">&amp;</span><span style=\"color: #657B83\">filter);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">template</span><span style=\"color: #657B83\"> &lt;</span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">input, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> x, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> y,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> z, </span><span style=\"color: #586E75; font-weight: bold\">int</span><span style=\"color: #657B83\"> min_pt_num) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> filter;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;(input, filter, x, y, z, min_pt_num, input);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">template</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span></span>\n<span class=\"line\"><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;(</span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">&amp;</span><span style=\"color: #657B83\">input, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> x,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">                  </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> y, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> z, </span><span style=\"color: #586E75; font-weight: bold\">int</span><span style=\"color: #657B83\"> min_pt_num);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">template</span><span style=\"color: #657B83\"> &lt;</span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">input,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">filter, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> x, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> y,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> z, </span><span style=\"color: #586E75; font-weight: bold\">int</span><span style=\"color: #657B83\"> min_pt_num,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">               </span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">&amp;</span><span style=\"color: #657B83\">output) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #859900\">!</span><span style=\"color: #657B83\">input </span><span style=\"color: #859900\">||</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">!</span><span style=\"color: #657B83\">output) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #CB4B16\">std</span><span style=\"color: #657B83\">::cerr </span><span style=\"color: #859900\">&lt;&lt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #2AA198\">&quot;异常: input或ouput空指针&quot;</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">&lt;&lt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">std</span><span style=\"color: #657B83\">::endl;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #859900\">!</span><span style=\"color: #657B83\">filter) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    filter </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">std</span><span style=\"color: #657B83\">::</span><span style=\"color: #268BD2\">make_shared</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">A</span><span style=\"color: #657B83\">&gt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">filter</span><span style=\"color: #657B83\">-&gt;</span><span style=\"color: #268BD2\">setInputCloud</span><span style=\"color: #657B83\">(input);</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">  // 设置体素滤波时创建的体素体积为xyz的立方体</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">filter</span><span style=\"color: #657B83\">-&gt;</span><span style=\"color: #268BD2\">setLeafSize</span><span style=\"color: #657B83\">(x, y, z);</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">  // 每1个体素内需要包含的最小点个数</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">filter</span><span style=\"color: #657B83\">-&gt;</span><span style=\"color: #268BD2\">setMinimumPointsNumberPerVoxel</span><span style=\"color: #657B83\">(min_pt_num);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">filter</span><span style=\"color: #657B83\">-&gt;</span><span style=\"color: #268BD2\">filter</span><span style=\"color: #657B83\">(</span><span style=\"color: #859900\">*</span><span style=\"color: #657B83\">output);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">template</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span></span>\n<span class=\"line\"><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;(</span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">&amp;</span><span style=\"color: #657B83\">input,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">                 </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">&amp;</span><span style=\"color: #657B83\">filter, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> x, </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> y,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">                 </span><span style=\"color: #586E75; font-weight: bold\">float</span><span style=\"color: #657B83\"> z, </span><span style=\"color: #586E75; font-weight: bold\">int</span><span style=\"color: #657B83\"> min_pt_num,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">                 </span><span style=\"color: #586E75; font-weight: bold\">const</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">typename</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">PointCloud</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;::</span><span style=\"color: #CB4B16\">Ptr</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">&amp;</span><span style=\"color: #657B83\">output);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">...                  </span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span><span style=\"color: #93A1A1; font-style: italic\"> // namespace filter</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span><span style=\"color: #93A1A1; font-style: italic\"> // namespace pcr</span></span></code></pre></div><hr>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>这里我们根据需求实现了滤波算法.<br>实时情况下参数一般都是启动时配置好,主要在意复用滤波器指针.</p>\n<div class=\"language-cpp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">cpp</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;::Ptr filter </span><span style=\"color: #859900\">=</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #CB4B16\">std</span><span style=\"color: #657B83\">::</span><span style=\"color: #268BD2\">make_shared</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #CB4B16\">pcr</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">filter</span><span style=\"color: #657B83\">::</span><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;(input, filter);</span></span></code></pre></div><p>离线情况下不关心滤波器指针,更在意传入的算法参数.</p>\n<div class=\"language-cpp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">cpp</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #CB4B16\">pcl</span><span style=\"color: #657B83\">::</span><span style=\"color: #CB4B16\">filter</span><span style=\"color: #657B83\">::</span><span style=\"color: #268BD2\">VoxelGrid</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #CB4B16\">PointI</span><span style=\"color: #657B83\">&gt;(input, </span><span style=\"color: #D33682\">0.1</span><span style=\"color: #657B83\">, </span><span style=\"color: #D33682\">0.1</span><span style=\"color: #657B83\">, </span><span style=\"color: #D33682\">0.1</span><span style=\"color: #657B83\">, </span><span style=\"color: #D33682\">1</span><span style=\"color: #657B83\">);</span></span></code></pre></div>","text":"前言体素滤波: 大白话就是降低分辨率从而减少点云大小. 代码算法参数体素滤波共有四个核心参数 1: leaf_size_x 2: leaf_size_y 3: ...","permalink":"/post/大白话点云开发(6)-滤波模块(二)-体素滤波","photos":[],"count_time":{"symbolsCount":"4.2k","symbolsTime":"4 mins."},"categories":[{"name":"点云","slug":"点云","count":6,"path":"api/categories/点云.json"}],"tags":[{"name":"PCL","slug":"PCL","count":5,"path":"api/tags/PCL.json"},{"name":"点云","slug":"点云","count":4,"path":"api/tags/点云.json"},{"name":"C++","slug":"C","count":3,"path":"api/tags/C.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">代码</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AE%97%E6%B3%95%E5%8F%82%E6%95%B0\"><span class=\"toc-text\">算法参数</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">算法实现</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li></ol>","author":{"name":"因雨而生","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"一直没脱离低级趣味的Coder","socials":{"github":"https://github.com/BornToRain","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"大白话点云开发(5)-滤波模块(一)","uid":"f937c5eee28ffc403ff02d90a868e21a","slug":"大白话点云开发(5)-滤波模块(一)","date":"2024-03-28T16:46:13.000Z","updated":"2024-03-28T17:36:32.802Z","comments":true,"path":"api/articles/大白话点云开发(5)-滤波模块(一).json","keywords":["Coder","Scalaer","Javaer"],"cover":"/images/ros2logo.png","text":"前言先把工程建好. 项目工程结构shellcd filter mkdir include mkdir src touch CMakeLists.txt touc...","permalink":"/post/大白话点云开发(5)-滤波模块(一)","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"点云","slug":"点云","count":6,"path":"api/categories/点云.json"}],"tags":[{"name":"PCL","slug":"PCL","count":5,"path":"api/tags/PCL.json"},{"name":"点云","slug":"点云","count":4,"path":"api/tags/点云.json"},{"name":"C++","slug":"C","count":3,"path":"api/tags/C.json"}],"author":{"name":"因雨而生","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"一直没脱离低级趣味的Coder","socials":{"github":"https://github.com/BornToRain","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}