{"title":"从零开始撸框架(8)-与Vert.x集成 Web篇(二)","uid":"31ebad76ece9cbfbb4b4be8543fa818d","slug":"从零开始撸框架(8)-与Vert.x集成 Web篇(二)","date":"2021-05-12T06:33:24.000Z","updated":"2021-06-28T09:51:53.342Z","comments":true,"path":"api/articles/从零开始撸框架(8)-与Vert.x集成 Web篇(二).json","keywords":["Coder","Scalaer","Javaer"],"cover":"/images/vertxlogo.png","content":"<p>上一篇讲完了全局配置,这一篇我们来讲每个路由的集成.</p>\n<h2 id=\"Vert-x原始使用方式\"><a href=\"#Vert-x原始使用方式\" class=\"headerlink\" title=\"Vert.x原始使用方式\"></a>Vert.x原始使用方式</h2><p>样例来自于<a href=\"https://vertx.io/\">Vert.x官网</a></p>\n<h3 id=\"Vert-x配置api接口\"><a href=\"#Vert-x配置api接口\" class=\"headerlink\" title=\"Vert.x配置api接口\"></a>Vert.x配置api接口</h3><div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">TestVerticle</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">extends</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">AbstractVerticle</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">start</span><span style=\"color: #657B83\">() </span><span style=\"color: #586E75; font-weight: bold\">throws</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Exception</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #586E75; font-weight: bold\">Router</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">router</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Router</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">router</span><span style=\"color: #657B83\">(vertx);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">route</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">(GET).</span><span style=\"color: #268BD2\">path</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/api1&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">consumes</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;app/json&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">produces</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;app/json&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">handler</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">failureHandler</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">route</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">(GET).</span><span style=\"color: #268BD2\">path</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/api2&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">consumes</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;app/json&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">produces</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;app/json&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">handler</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">failureHandler</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p>原始使用方式链式编程写起来是很方便,但是全部路由都得写在一起集中管理,对于习惯了传统模式的人很不友好,下面我们来加以改造让它更符合我们更习惯的使用方式.</p>\n<p>改造的话分为以下几个方面:</p>\n<ol>\n<li>请求路径</li>\n<li>请求方式</li>\n<li>媒体类型</li>\n<li>响应状态</li>\n<li>请求参数</li>\n<li>http工作流</li>\n</ol>\n<p>其中1-4为静态解析,即代码编译期我们就能确定值.5-6为动态解析,每次请求它的参数,工作流都不相同,需要我们动态解析去确定.</p>\n<p>下面我们先完成静态解析部分.</p>\n<h2 id=\"静态解析\"><a href=\"#静态解析\" class=\"headerlink\" title=\"静态解析\"></a>静态解析</h2><h3 id=\"请求路径\"><a href=\"#请求路径\" class=\"headerlink\" title=\"请求路径\"></a>请求路径</h3><p>首先是第一步,api请求路径解析.</p>\n<p>上文说到了我们会用到jsr311注解,jsr311中是使用 <em>@Path</em>来获取路径的,这里我们写一个工具类来解析@Path注解.<br><strong>Paths.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Fn</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.Path</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Objects</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 解析@Path获取请求路径</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">Paths</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">resolve</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Path</span><span style=\"color: #657B83\"> path) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">resolve</span><span style=\"color: #657B83\">(path, </span><span style=\"color: #B58900\">null</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">resolve</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Path</span><span style=\"color: #657B83\"> path, </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> root) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureRun</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isNull</span><span style=\"color: #657B83\">(root),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 顶级路径</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">adjust</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">path</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">value</span><span style=\"color: #657B83\">()),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #93A1A1; font-style: italic\">// 先取上级路径</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        val rootPath </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">adjust</span><span style=\"color: #657B83\">(root);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #93A1A1; font-style: italic\">// 当前路径</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        val subPath </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">adjust</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">path</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">value</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #93A1A1; font-style: italic\">// 1 == /</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #D33682\">1</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">==</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">rootPath</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">length</span><span style=\"color: #657B83\">() </span><span style=\"color: #859900\">?</span><span style=\"color: #657B83\"> subPath </span><span style=\"color: #859900\">:</span><span style=\"color: #657B83\"> rootPath </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> subPath;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">  /**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * uri必须是/开头无/结尾,无多//形式.</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * ex: / -&gt; /</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * ex: /hello -&gt; /hello</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * ex: /hello/ -&gt; /hello</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * ex: /hello// -&gt; /hello</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">adjust</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> path) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 多//转单/</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #586E75; font-weight: bold\">var</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">uri</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">path</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">replace</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;</span><span style=\"color: #CB4B16\">\\\\</span><span style=\"color: #2AA198\">/+&quot;</span><span style=\"color: #657B83\">, </span><span style=\"color: #2AA198\">&quot;/&quot;</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 去尾斜杠</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #268BD2\">uri</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">endsWith</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/&quot;</span><span style=\"color: #657B83\">)) uri </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">uri</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">substring</span><span style=\"color: #657B83\">(</span><span style=\"color: #D33682\">0</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">uri</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">lastIndexOf</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/&quot;</span><span style=\"color: #657B83\">));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// /开头</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\">  </span><span style=\"color: #268BD2\">uri</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">charAt</span><span style=\"color: #657B83\">(</span><span style=\"color: #D33682\">0</span><span style=\"color: #657B83\">) </span><span style=\"color: #859900\">==</span><span style=\"color: #657B83\"> </span><span style=\"color: #2AA198\">&#39;/&#39;</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">?</span><span style=\"color: #657B83\"> uri </span><span style=\"color: #859900\">:</span><span style=\"color: #657B83\"> </span><span style=\"color: #2AA198\">&#39;/&#39;</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> uri;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h3 id=\"请求方式\"><a href=\"#请求方式\" class=\"headerlink\" title=\"请求方式\"></a>请求方式</h3><p>解析完请求路径开始解析请求方式.jsr311请求方式注解:</p>\n<ul>\n<li>GET </li>\n<li>POST</li>\n<li>PUT</li>\n<li>DELTE</li>\n<li>..</li>\n</ul>\n<p>在<strong>Trunk.java</strong>中追加</p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">Trunk</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 存放的是每个请求方式对应的请求路径集合.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">HttpMethod</span><span style=\"color: #657B83\">, </span><span style=\"color: #586E75; font-weight: bold\">Set</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\">&gt;&gt; </span><span style=\"color: #268BD2\">METHOD_URIS</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Map</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">of</span><span style=\"color: #657B83\">(</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">GET</span><span style=\"color: #657B83\">, </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashSet</span><span style=\"color: #657B83\">&lt;&gt;(),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">POST</span><span style=\"color: #657B83\">, </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashSet</span><span style=\"color: #657B83\">&lt;&gt;(),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">PUT</span><span style=\"color: #657B83\">, </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashSet</span><span style=\"color: #657B83\">&lt;&gt;(),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">DELETE</span><span style=\"color: #657B83\">, </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashSet</span><span style=\"color: #657B83\">&lt;&gt;(),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">PATCH</span><span style=\"color: #657B83\">, </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashSet</span><span style=\"color: #657B83\">&lt;&gt;()</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  );</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p><strong>HttpMehotds.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.http.HttpMethod</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Fn</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.scan.Request</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.DELETE</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.GET</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.HEAD</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.OPTIONS</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.PATCH</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.POST</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.PUT</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.lang.annotation.Annotation</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.lang.reflect.Method</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Map</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 解析@GET..注解获取请求方式</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">HttpMethods</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// jsr311与Vert.x映射关系</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;, </span><span style=\"color: #586E75; font-weight: bold\">HttpMethod</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">METHODS</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Map</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">of</span><span style=\"color: #657B83\">(</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">GET</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">GET</span><span style=\"color: #657B83\">,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">POST</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">POST</span><span style=\"color: #657B83\">,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">PUT</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">PUT</span><span style=\"color: #657B83\">,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">DELETE</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">DELETE</span><span style=\"color: #657B83\">,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">OPTIONS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">OPTIONS</span><span style=\"color: #657B83\">,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">PATCH</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">PATCH</span><span style=\"color: #657B83\">,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">HEAD</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">HEAD</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  );</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">resolve</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> req) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureExec</span><span style=\"color: #657B83\">(() </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val value </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Trunk</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">METHOD_URIS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getHttpMethod</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">value</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">add</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getPath</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;, </span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getHttpMethod</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HttpMethod</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">resolve</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Method</span><span style=\"color: #657B83\"> method) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val annos </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getDeclaredAnnotations</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #586E75; font-weight: bold\">HttpMethod</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">ret</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #B58900\">null</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">for</span><span style=\"color: #657B83\"> (</span><span style=\"color: #586E75; font-weight: bold\">Annotation</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">annotation</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">:</span><span style=\"color: #657B83\"> annos) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val key </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">annotation</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">annotationType</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #268BD2\">METHODS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">containsKey</span><span style=\"color: #657B83\">(key)) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        ret </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">METHODS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(key);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #859900\">break</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> ret;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h3 id=\"媒体类型\"><a href=\"#媒体类型\" class=\"headerlink\" title=\"媒体类型\"></a>媒体类型</h3><p>媒体类型同理,jsr311中:</p>\n<ul>\n<li>@Consumes 指定请求内容类型(Content-Type). ex: application&#x2F;json;</li>\n<li>@Produces 指定响应内容类型(Accept),不过只有当请求头中Accept包含指定类型才返回.</li>\n</ul>\n<p><strong>MediaTypes.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.Consumes</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.Produces</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.lang.reflect.Method</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Arrays</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Objects</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Set</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.stream.Collectors</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">MediaTypes</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 默认类型 wildcard</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Set</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">DEFAULT</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Set</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">of</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;*/*&quot;</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Set</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">resolveConsumes</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Method</span><span style=\"color: #657B83\"> method) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val anno </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAnnotation</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Consumes</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureRun</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isNull</span><span style=\"color: #657B83\">(anno),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> DEFAULT,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Arrays</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">stream</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">anno</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">value</span><span style=\"color: #657B83\">()).</span><span style=\"color: #268BD2\">collect</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Collectors</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">toSet</span><span style=\"color: #657B83\">()));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Set</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">resolveProduces</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Method</span><span style=\"color: #657B83\"> method) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val anno </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAnnotation</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Produces</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureRun</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isNull</span><span style=\"color: #657B83\">(anno),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> DEFAULT,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Arrays</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">stream</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">anno</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">value</span><span style=\"color: #657B83\">()).</span><span style=\"color: #268BD2\">collect</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Collectors</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">toSet</span><span style=\"color: #657B83\">()));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span>\n<span class=\"line\"></span></code></pre></div><h3 id=\"响应状态\"><a href=\"#响应状态\" class=\"headerlink\" title=\"响应状态\"></a>响应状态</h3><p>响应状态解析于我们自定义注解<em>ResponstStatus.java</em>.</p>\n<p><strong>ResponstStatuses.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Fn</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.annotations.ResponseStatus</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.constant.HttpStatus</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.lang.reflect.Method</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Objects</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">ResponstStatuses</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 这里默认状态返回200 Ok</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HttpStatus</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">resolveConsumes</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Method</span><span style=\"color: #657B83\"> method) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val anno </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAnnotation</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">ResponseStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureRun</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isNull</span><span style=\"color: #657B83\">(anno), () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">HttpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">OK</span><span style=\"color: #657B83\">, () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">anno</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">value</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span>\n<span class=\"line\"></span></code></pre></div><h3 id=\"扫描器\"><a href=\"#扫描器\" class=\"headerlink\" title=\"扫描器\"></a>扫描器</h3><p>继承前文<em>IScanner.java</em>实现以下功能.</p>\n<h4 id=\"接口扫描器\"><a href=\"#接口扫描器\" class=\"headerlink\" title=\"接口扫描器\"></a>接口扫描器</h4><p>扫描带 <em>@Api</em>的文件,将其标识为接口文件.</p>\n<p><strong>ApiScanner.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.scan</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Console</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.scan.IScanner</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.annotations.Api</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Set</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.stream.Collectors</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">ApiScanner</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">IScanner</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Set</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;&gt;&gt; &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Set</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;&gt; </span><span style=\"color: #268BD2\">scan</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Set</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;&gt; classes) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val ret </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">classes</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">stream</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">filter</span><span style=\"color: #657B83\">(d </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">d</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isAnnotationPresent</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Api</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">))</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">collect</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Collectors</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">toSet</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">SCANNED</span><span style=\"color: #657B83\">, </span><span style=\"color: #2AA198\">&quot;Api&quot;</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">ret</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">size</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> ret;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h4 id=\"请求扫描器\"><a href=\"#请求扫描器\" class=\"headerlink\" title=\"请求扫描器\"></a>请求扫描器</h4><p>把上述的静态参数扫描,将其转换成<em>Request.java</em>实体类.</p>\n<p><strong>RequestScanner.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.scan</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.annotations.Addr</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Console</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Const</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Fn</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Methods</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.scan.IScanner</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.annotations.ResponseStatus</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.constant.HttpStatus</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit.HttpMethods</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit.MediaTypes</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit.Paths</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.Path</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.lang.reflect.Method</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Arrays</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.List</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Objects</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Set</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.stream.Collectors</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.stream.Stream</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">RequestScanner</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">IScanner</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">List</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\">&gt;&gt; &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">List</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">scan</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Set</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;&gt; classes) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val ret </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">classes</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">stream</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">flatMap</span><span style=\"color: #657B83\">(d </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureRun</span><span style=\"color: #657B83\">(</span><span style=\"color: #859900\">!</span><span style=\"color: #268BD2\">d</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isAnnotationPresent</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Path</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 顶级uri路径</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">extract</span><span style=\"color: #657B83\">(d, </span><span style=\"color: #B58900\">null</span><span style=\"color: #657B83\">),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 非顶级uri路径</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">extract</span><span style=\"color: #657B83\">(d, </span><span style=\"color: #268BD2\">Paths</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">resolve</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">d</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAnnotation</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Path</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">)))))</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">sorted</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">this</span><span style=\"color: #859900\">::</span><span style=\"color: #657B83\">sort)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">collect</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Collectors</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">toList</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">SCANNED</span><span style=\"color: #657B83\">, </span><span style=\"color: #2AA198\">&quot;Request&quot;</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">ret</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">size</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> ret;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">  /**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * vert.x路由顺序会影响到接口</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * 1. path参数放最后</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * 2. 长的放最前面</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * ex: /users/:id</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   *     /users/abc</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   *     /users</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   * ret: /users/abc</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   *      /users</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   *      /users/:id</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">   */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">int</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">sort</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> x, </span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> y) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val xPath </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">x</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getPath</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val yPath </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">y</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getPath</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #586E75; font-weight: bold\">var</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">b</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #D33682\">0</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #268BD2\">xPath</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">contains</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">COLON</span><span style=\"color: #657B83\">)) b </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #D33682\">1</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">else</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #268BD2\">xPath</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">length</span><span style=\"color: #657B83\">() </span><span style=\"color: #859900\">&gt;=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">yPath</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">length</span><span style=\"color: #657B83\">()) b </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">-</span><span style=\"color: #D33682\">1</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> b;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Stream</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">extract</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; cls, </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> root) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Arrays</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">stream</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">cls</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getDeclaredMethods</span><span style=\"color: #657B83\">()).</span><span style=\"color: #268BD2\">filter</span><span style=\"color: #657B83\">(Methods</span><span style=\"color: #859900\">::</span><span style=\"color: #657B83\">validateMethod)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">map</span><span style=\"color: #657B83\">(d </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">extract</span><span style=\"color: #657B83\">(d, root));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">extract</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Method</span><span style=\"color: #657B83\"> method, </span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> root) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val data </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Request</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">setMethod</span><span style=\"color: #657B83\">(method).</span><span style=\"color: #268BD2\">setHttpMethod</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpMethods</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">resolve</span><span style=\"color: #657B83\">(method))</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">setConsumes</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">MediaTypes</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">resolveConsumes</span><span style=\"color: #657B83\">(method))</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">setProduces</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">MediaTypes</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">resolveProduces</span><span style=\"color: #657B83\">(method));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val anno </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAnnotation</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Path</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val path </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureRun</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isNull</span><span style=\"color: #657B83\">(anno),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> root,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Paths</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">resolve</span><span style=\"color: #657B83\">(anno, root));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">data</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">setPath</span><span style=\"color: #657B83\">(path);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">data</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">setAddr</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAnnotation</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Addr</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">value</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">data</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">setProxy</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Trunk</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getProxy</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getDeclaringClass</span><span style=\"color: #657B83\">()));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val httpStatus </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAnnotation</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">ResponseStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// () -&gt; httpStatus.value()不能缩写成httpStatus::value,这里必须lazy.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">data</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">setHttpStatus</span><span style=\"color: #657B83\">(</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureRun</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isNull</span><span style=\"color: #657B83\">(httpStatus), () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">HttpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">OK</span><span style=\"color: #657B83\">, () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">httpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">value</span><span style=\"color: #657B83\">()));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> data;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><p>把静态部分测试一下</p>\n<p><strong>IScannerTest.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.scan</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.http.HttpMethod</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.annotations.Addr</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Packages</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.annotations.Api</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.annotations.ResponseStatus</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.constant.HttpStatus</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.hamcrest.CoreMatchers</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.junit.Assert</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.junit.Test</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.DELETE</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.GET</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.POST</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.PUT</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.Path</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Arrays</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">IScannerTest</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Api</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Path</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/test&quot;</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">interface</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">TestEventloop</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">GET</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">Path</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/hello/:id&quot;</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">Addr</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;get&quot;</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">POST</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">Path</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/hello&quot;</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">Addr</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;post&quot;</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">ResponseStatus</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">CREATED</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">post</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">PUT</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">Path</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/users/hello&quot;</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">Addr</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;put&quot;</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">ResponseStatus</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ACCEPTED</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">put</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">DELETE</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">Path</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/hello/:id&quot;</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">Addr</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;delete&quot;</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    @</span><span style=\"color: #586E75; font-weight: bold\">ResponseStatus</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">NO_CONTENT</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">delete</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Test</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">testApi</span><span style=\"color: #657B83\">() &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val classes </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Packages</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">scan</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val scanner </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> Trunk.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #657B83\">ApiScanner</span><span style=\"color: #859900\">&gt;</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">ApiScanner</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val ret </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">scanner</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">scan</span><span style=\"color: #657B83\">(classes);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Assert</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">assertThat</span><span style=\"color: #657B83\">(ret, </span><span style=\"color: #268BD2\">CoreMatchers</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">hasItem</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">TestEventloop</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Test</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">testRequest</span><span style=\"color: #657B83\">() &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val classes </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Packages</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">scan</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val api </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> Trunk.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #657B83\">ApiScanner</span><span style=\"color: #859900\">&gt;</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">ApiScanner</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val scanner </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> Trunk.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #657B83\">RequestScanner</span><span style=\"color: #859900\">&gt;</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">RequestScanner</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val ret </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">scanner</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">scan</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">api</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">scan</span><span style=\"color: #657B83\">(classes));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val get </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Request</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">setAddr</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;get&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">setPath</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/test/hello/:id&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">setHttpMethod</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">GET</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">setHttpStatus</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">OK</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val post </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Request</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">setAddr</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;post&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">setPath</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/test/hello&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">setHttpMethod</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">POST</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">setHttpStatus</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">CREATED</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val put </span><span style=\"color: #859900\">=</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Request</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">setAddr</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;put&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">setPath</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/test/users/hello&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">setHttpMethod</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">PUT</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        .</span><span style=\"color: #268BD2\">setHttpStatus</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ACCEPTED</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val delete </span><span style=\"color: #859900\">=</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Request</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">setAddr</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;delete&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">setPath</span><span style=\"color: #657B83\">(</span><span style=\"color: #2AA198\">&quot;/test/hello/:id&quot;</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">setHttpMethod</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">DELETE</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        .</span><span style=\"color: #268BD2\">setHttpStatus</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">NO_CONTENT</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val xs </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Arrays</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">asList</span><span style=\"color: #657B83\">(get, post, put, delete);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val b </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">ret</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">stream</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">allMatch</span><span style=\"color: #657B83\">(x </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">xs</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">stream</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">anyMatch</span><span style=\"color: #657B83\">(y </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">compare</span><span style=\"color: #657B83\">(x, y)));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Assert</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">assertTrue</span><span style=\"color: #657B83\">(b);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">boolean</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">compare</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> x, </span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> y) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">x</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getPath</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">equals</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">y</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getPath</span><span style=\"color: #657B83\">()) </span><span style=\"color: #859900\">&amp;&amp;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">x</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAddr</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">equals</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">y</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAddr</span><span style=\"color: #657B83\">()) </span><span style=\"color: #859900\">&amp;&amp;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">x</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getHttpMethod</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">equals</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">y</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getHttpMethod</span><span style=\"color: #657B83\">()) </span><span style=\"color: #859900\">&amp;&amp;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">x</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getHttpStatus</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">equals</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">y</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getHttpStatus</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p>测试结果<br><img src=\"/images/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%92%B8%E6%A1%86%E6%9E%B6/7/testret1.png\" alt=\"运行结果\"></p>\n<hr>\n<h2 id=\"动态解析\"><a href=\"#动态解析\" class=\"headerlink\" title=\"动态解析\"></a>动态解析</h2><h3 id=\"请求参数\"><a href=\"#请求参数\" class=\"headerlink\" title=\"请求参数\"></a>请求参数</h3><p>请求参数解析分为两步.</p>\n<ol>\n<li>注解解析: 根据注解决定调用何种解析方式,最典型的例子就是分别带有 <em>@PathParam</em>、*@BodyParam*注解的参数.</li>\n<li>类型解析: 根据类型决定调用何种类型转换方式.</li>\n</ol>\n<p>根据上面我们可以抽象出两个接口.</p>\n<h4 id=\"基类\"><a href=\"#基类\" class=\"headerlink\" title=\"基类\"></a>基类</h4><p><strong>IParamParser.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.parse</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.RoutingContext</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.annotations.BodyParam</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.lang.reflect.Parameter</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.HashMap</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Map</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">interface</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">IParamParser</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 表驱动模式</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;, </span><span style=\"color: #586E75; font-weight: bold\">IParamParser</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">MAP</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;() &lt;</span><span style=\"color: #859900\">!--</span><span style=\"color: #657B83\">swig￼</span><span style=\"color: #D33682\">0</span><span style=\"color: #859900\">--&gt;</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">IParamParser</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; key) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 找不到解析器默认采用Body解析器</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">MAP</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getOrDefault</span><span style=\"color: #657B83\">(key, </span><span style=\"color: #268BD2\">Trunk</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">BodyParamParser</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">parse</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">RoutingContext</span><span style=\"color: #657B83\"> context, </span><span style=\"color: #586E75; font-weight: bold\">Parameter</span><span style=\"color: #657B83\"> param);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p><strong>IConvert.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.convert</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.json.JsonObject</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.HashMap</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.List</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Map</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">interface</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">IConvert</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #93A1A1; font-style: italic\">// 表驱动模式</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;, </span><span style=\"color: #586E75; font-weight: bold\">IConvert</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">MAP</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;() &lt;</span><span style=\"color: #859900\">!--</span><span style=\"color: #657B83\">swig￼</span><span style=\"color: #D33682\">1</span><span style=\"color: #859900\">--&gt;</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">IConvert</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; key) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 找不到可用转换器,默认调用字符串转换器.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">MAP</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getOrDefault</span><span style=\"color: #657B83\">(key, </span><span style=\"color: #268BD2\">Trunk</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">StringConvert</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">convert</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> str);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h4 id=\"具体实现\"><a href=\"#具体实现\" class=\"headerlink\" title=\"具体实现\"></a>具体实现</h4><p>挨个实现比较长,这里我仅以解析 <em>@BodyParam</em>注解和参数类型为<em>Int</em>的代码为例.</p>\n<p><strong>IntConvert.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.convert</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Fn</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">IntConvert</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">IConvert</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">convert</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> str) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureRun</span><span style=\"color: #657B83\">(() </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Integer</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">parseInt</span><span style=\"color: #657B83\">(str), str);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p><strong>BodyParamParser.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.parse</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.RoutingContext</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.convert.IConvert</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.lang.reflect.Parameter</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">BodyParamParser</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">IParamParser</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">parse</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">RoutingContext</span><span style=\"color: #657B83\"> context, </span><span style=\"color: #586E75; font-weight: bold\">Parameter</span><span style=\"color: #657B83\"> param) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 通过字段类型找到转换器开始转换请求参数值.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">IConvert</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">param</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getType</span><span style=\"color: #657B83\">()).</span><span style=\"color: #268BD2\">convert</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">context</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getBodyAsString</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p>多种注解以及类型解析只需挨个继承实现<em>IParamParser.java</em>和<em>IConvert.java</em>即可.</p>\n<h3 id=\"http工作流\"><a href=\"#http工作流\" class=\"headerlink\" title=\"http工作流\"></a>http工作流</h3><p>一次http请求响应过程如下:</p>\n<ol>\n<li>接收请求 </li>\n<li>解析请求路径、方式、媒体类型等…各个参数(静态解析部分)</li>\n<li>调用函数处理(Async、Sync、Rx…等反射调用)</li>\n<li>Reactor结构请求(Vert.x中用EventBus实现)</li>\n<li>根据请求头返回对应数据结构数据(Json、Xml、Text、二进制…不同响应策略)</li>\n</ol>\n<p>根据上述写出接口.</p>\n<h4 id=\"基类-1\"><a href=\"#基类-1\" class=\"headerlink\" title=\"基类\"></a>基类</h4><p>响应工具类.</p>\n<p><strong>Responds.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.http.HttpServerResponse</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.RoutingContext</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Fn</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.constant.HttpStatus</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.scan.Request</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Objects</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">Responds</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">failed</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">RoutingContext</span><span style=\"color: #657B83\"> context, </span><span style=\"color: #586E75; font-weight: bold\">Throwable</span><span style=\"color: #657B83\"> ex) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">nonNull</span><span style=\"color: #657B83\">(ex)) </span><span style=\"color: #268BD2\">ex</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">printStackTrace</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val rep </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">context</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">response</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #859900\">!</span><span style=\"color: #268BD2\">rep</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">closed</span><span style=\"color: #657B83\">()) </span><span style=\"color: #268BD2\">rep</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">setStatusCode</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">INTERNAL_SERVER_ERROR</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">code</span><span style=\"color: #657B83\">)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">setStatusMessage</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">INTERNAL_SERVER_ERROR</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">msg</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HttpServerResponse</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">succeed</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">RoutingContext</span><span style=\"color: #657B83\"> context, </span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> req) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val rep </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">context</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">response</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureRun</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">rep</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">closed</span><span style=\"color: #657B83\">(),</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> rep,</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        val httpStatus </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getHttpStatus</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">rep</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">setStatusCode</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">httpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">code</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">setStatusMessage</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">httpStatus</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">msg</span><span style=\"color: #657B83\">);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p>响应数据结构接口,根据不同结构实现不同子类.</p>\n<p><strong>IRepStruct.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.struct</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.http.HttpServerResponse</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">javax.ws.rs.core.MediaType</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.HashMap</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Map</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 响应数据结构</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 1. Json</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 2. Xml</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 3. Text</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 4. 二进制</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * ...</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">interface</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">RepStruct</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\">, </span><span style=\"color: #586E75; font-weight: bold\">RepStruct</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">MAP</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;() &lt;</span><span style=\"color: #859900\">!--</span><span style=\"color: #657B83\">swig￼</span><span style=\"color: #D33682\">2</span><span style=\"color: #859900\">--&gt;</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">RepStruct</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">String</span><span style=\"color: #657B83\"> key) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">MAP</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getOrDefault</span><span style=\"color: #657B83\">(key, </span><span style=\"color: #268BD2\">Trunk</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">JsonRepStruct</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">respond</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">HttpServerResponse</span><span style=\"color: #657B83\"> rep, </span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\"> ret);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p>http流接口,子类实现不同http工作流程.</p>\n<p><strong>IHttpFlow.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.Future</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.Handler</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.RoutingContext</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.scan.Request</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.HashMap</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Map</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * http工作流</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 1. 接收请求</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 2. 解析请求路径、方式、媒体类型等...各个参数</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 3. 调用函数处理(Async、Sync、Rx...)</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 4. Reactor结构请求(Vert.x中用EventBus实现)</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * 5. 根据请求头返回对应数据结构数据(Json、Xml、Text、二进制...)</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">interface</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">IFlow</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">Map</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt;, </span><span style=\"color: #586E75; font-weight: bold\">IFlow</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">MAP</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">HashMap</span><span style=\"color: #657B83\">&lt;&gt;() &lt;</span><span style=\"color: #859900\">!--</span><span style=\"color: #657B83\">swig￼</span><span style=\"color: #D33682\">3</span><span style=\"color: #859900\">--&gt;</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">static</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">IFlow</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Class</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">?</span><span style=\"color: #657B83\">&gt; key) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">MAP</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getOrDefault</span><span style=\"color: #657B83\">(key, </span><span style=\"color: #268BD2\">Trunk</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">FutureFlow</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">Handler</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">RoutingContext</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">handle</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> req);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><h4 id=\"具体实现-1\"><a href=\"#具体实现-1\" class=\"headerlink\" title=\"具体实现\"></a>具体实现</h4><p>这里仅实现Vert.x中的Future响应流与Json数据结构.</p>\n<p><strong>JsonRepStruct.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.struct</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.http.HttpServerResponse</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.json.Json</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Fn</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Objects</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">JsonRepStruct</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">RepStruct</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">respond</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">HttpServerResponse</span><span style=\"color: #657B83\"> rep, </span><span style=\"color: #586E75; font-weight: bold\">Object</span><span style=\"color: #657B83\"> ret) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">ensureRun</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">nonNull</span><span style=\"color: #657B83\">(ret), () </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">rep</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">end</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Json</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">encode</span><span style=\"color: #657B83\">(ret)), rep</span><span style=\"color: #859900\">::</span><span style=\"color: #657B83\">end);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p><strong>FutureHttpFlow.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.flow</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.Handler</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.RoutingContext</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Console</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Const</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Fn</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Reflect</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Verticles</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit.Responds</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.parse.IParamParser</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.scan.Request</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.struct.RepStruct</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">FutureFlow</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">implements</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">IFlow</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Handler</span><span style=\"color: #657B83\">&lt;</span><span style=\"color: #586E75; font-weight: bold\">RoutingContext</span><span style=\"color: #657B83\">&gt; </span><span style=\"color: #268BD2\">handle</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> req) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> context </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 1. 解析参数</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val args </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">IParamParser</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">parseArgs</span><span style=\"color: #657B83\">(context, req);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 2. 调用函数(Async,Sync,Rx...)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val method </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getMethod</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val methodName </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getName</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val ret </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Reflect</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">invokeMethod</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getProxy</span><span style=\"color: #657B83\">(), methodName, args);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">INVOKE</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getDeclaringClass</span><span style=\"color: #657B83\">(), methodName, </span><span style=\"color: #268BD2\">Fn</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">join</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">COMMA</span><span style=\"color: #657B83\">, args));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 3. event-bus请求(reactor结构)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val future </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">context</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">eventBus</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">request</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAddr</span><span style=\"color: #657B83\">(), ret, </span><span style=\"color: #268BD2\">Verticles</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">delivery</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">future</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">onComplete</span><span style=\"color: #657B83\">(ar </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #268BD2\">ar</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">failed</span><span style=\"color: #657B83\">()) </span><span style=\"color: #268BD2\">Responds</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">failed</span><span style=\"color: #657B83\">(context, </span><span style=\"color: #268BD2\">ar</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">cause</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #859900\">else</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">          </span><span style=\"color: #93A1A1; font-style: italic\">// 4. 响应数据结构(Json,Xml,Text...)</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">          val struct </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">RepStruct</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">context</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAcceptableContentType</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">          </span><span style=\"color: #268BD2\">struct</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">respond</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Responds</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">succeed</span><span style=\"color: #657B83\">(context, req), </span><span style=\"color: #268BD2\">ar</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">result</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">body</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><p>重构前文的<em>EventloopHttpActor.java</em>,把动态参数解析加上.</p>\n<p><strong>EventloopHttpActor.java</strong></p>\n<div class=\"language-java\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">java</span><pre class=\"shiki solarized-light\" style=\"background-color: #FDF6E3\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #859900\">package</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.actor</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.AbstractVerticle</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.http.HttpMethod</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.core.http.HttpServerOptions</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.Route</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.Router</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.handler.BodyHandler</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.handler.CorsHandler</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.handler.ResponseContentTypeHandler</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.handler.SessionHandler</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.handler.TimeoutHandler</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.sstore.ClusteredSessionStore</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">io.vertx.ext.web.sstore.LocalSessionStore</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.extern.log4j.Log4j2</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">lombok.val</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.annotations.Eventloop</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.constant.Const</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.core.kit.Trunk</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.config.CorsConfig</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.config.Server</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.constant.Console</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.flow.IFlow</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit.Deck</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.kit.Network</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">org.btr.ygo.web.scan.Request</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.lang.reflect.Method</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #859900\">import</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">java.util.Objects</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\">/**</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> * </span><span style=\"color: #859900; font-style: italic\">@author</span><span style=\"color: #93A1A1; font-style: italic\"> &lt;a href=&quot;mailto:1159930219@qq.com&quot;&gt;BornToRain&lt;/a&gt;</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1; font-style: italic\"> */</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Log4j2</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">@</span><span style=\"color: #586E75; font-weight: bold\">Eventloop</span></span>\n<span class=\"line\"><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">final</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">class</span><span style=\"color: #657B83\"> </span><span style=\"color: #CB4B16\">EventloopHttpActor</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">extends</span><span style=\"color: #657B83\"> </span><span style=\"color: #6C71C4\">AbstractVerticle</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  @</span><span style=\"color: #586E75; font-weight: bold\">Override</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">public</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">start</span><span style=\"color: #657B83\">() </span><span style=\"color: #586E75; font-weight: bold\">throws</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Exception</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Deck</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">HTTP_SERVERS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">forEach</span><span style=\"color: #657B83\">((port, config) </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val router </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Router</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">router</span><span style=\"color: #657B83\">(vertx);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">configRouter</span><span style=\"color: #657B83\">(router);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">configRequest</span><span style=\"color: #657B83\">(router);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">server</span><span style=\"color: #657B83\">(router, port, config);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">configRouter</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Router</span><span style=\"color: #657B83\"> router) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val store </span><span style=\"color: #859900\">=</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">isClustered</span><span style=\"color: #657B83\">() </span><span style=\"color: #859900\">?</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">ClusteredSessionStore</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">create</span><span style=\"color: #657B83\">(vertx) </span><span style=\"color: #859900\">:</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">LocalSessionStore</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">create</span><span style=\"color: #657B83\">(vertx);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val cors </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> Trunk.</span><span style=\"color: #859900\">&lt;</span><span style=\"color: #657B83\">CorsConfig</span><span style=\"color: #859900\">&gt;</span><span style=\"color: #268BD2\">singleton</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">CorsConfig</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">class</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">read</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// POST|PUT请求才接收body,其他不接收解析更快.</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">router</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">route</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">POST</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">HttpMethod</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">PUT</span><span style=\"color: #657B83\">).</span><span style=\"color: #268BD2\">handler</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">BodyHandler</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">create</span><span style=\"color: #657B83\">())</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 全局默认超时: 5s</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">handler</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">TimeoutHandler</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">create</span><span style=\"color: #657B83\">())</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">handler</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">ResponseContentTypeHandler</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">create</span><span style=\"color: #657B83\">())</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">handler</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">SessionHandler</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">create</span><span style=\"color: #657B83\">(store))</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #93A1A1; font-style: italic\">// 跨域</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      .</span><span style=\"color: #268BD2\">handler</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">CorsHandler</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">create</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">cors</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getOrigin</span><span style=\"color: #657B83\">()).</span><span style=\"color: #268BD2\">allowCredentials</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">cors</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAllowCredentials</span><span style=\"color: #657B83\">())</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        .</span><span style=\"color: #268BD2\">allowedHeaders</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">cors</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAllowedHeaders</span><span style=\"color: #657B83\">()).</span><span style=\"color: #268BD2\">allowedMethods</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">cors</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAllowedMethods</span><span style=\"color: #657B83\">()));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">server</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Router</span><span style=\"color: #657B83\"> router, </span><span style=\"color: #586E75; font-weight: bold\">Integer</span><span style=\"color: #657B83\"> port, </span><span style=\"color: #586E75; font-weight: bold\">Server</span><span style=\"color: #657B83\"> config) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val options </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">HttpServerOptions</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">config</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getOptions</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">vertx</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">createHttpServer</span><span style=\"color: #657B83\">(options).</span><span style=\"color: #268BD2\">requestHandler</span><span style=\"color: #657B83\">(router).</span><span style=\"color: #268BD2\">listen</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// 发布api地址</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val path </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #2AA198\">&quot;http://&quot;</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Network</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getIPv4</span><span style=\"color: #657B83\">() </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">COLON</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> port </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">SLASH</span><span style=\"color: #657B83\">;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">log</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">info</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">Console</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">SERVER</span><span style=\"color: #657B83\">, </span><span style=\"color: #268BD2\">getClass</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">getSimpleName</span><span style=\"color: #657B83\">(), </span><span style=\"color: #268BD2\">Const</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">HTTP</span><span style=\"color: #657B83\">, path);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">configRequest</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Router</span><span style=\"color: #657B83\"> router) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">Deck</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">REQUESTS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">forEach</span><span style=\"color: #657B83\">(req </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      val route </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">router</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">route</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getHttpMethod</span><span style=\"color: #657B83\">(), </span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getPath</span><span style=\"color: #657B83\">());</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">timeoutIf</span><span style=\"color: #657B83\">(req, route);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">mediaTypeIf</span><span style=\"color: #657B83\">(req, route);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">setHandler</span><span style=\"color: #657B83\">(req, route);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">timeoutIf</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> req, </span><span style=\"color: #586E75; font-weight: bold\">Route</span><span style=\"color: #657B83\"> route) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val timeout </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getTimeout</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">if</span><span style=\"color: #657B83\"> (</span><span style=\"color: #268BD2\">Objects</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">nonNull</span><span style=\"color: #657B83\">(timeout) </span><span style=\"color: #859900\">&amp;&amp;</span><span style=\"color: #657B83\"> timeout </span><span style=\"color: #859900\">&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #D33682\">0</span><span style=\"color: #657B83\">) </span><span style=\"color: #268BD2\">route</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">handler</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">TimeoutHandler</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">create</span><span style=\"color: #657B83\">(timeout));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">mediaTypeIf</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> req, </span><span style=\"color: #586E75; font-weight: bold\">Route</span><span style=\"color: #657B83\"> route) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getConsumes</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">forEach</span><span style=\"color: #657B83\">(route</span><span style=\"color: #859900\">::</span><span style=\"color: #657B83\">consumes);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getProduces</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">forEach</span><span style=\"color: #657B83\">(route</span><span style=\"color: #859900\">::</span><span style=\"color: #657B83\">produces);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">void</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">setHandler</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> req, </span><span style=\"color: #586E75; font-weight: bold\">Route</span><span style=\"color: #657B83\"> route) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val method </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">findReceipter</span><span style=\"color: #657B83\">(req);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #93A1A1; font-style: italic\">// TODO 目前只支持Async/Sync</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val handler </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">IFlow</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">get</span><span style=\"color: #657B83\">(</span><span style=\"color: #268BD2\">method</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getReturnType</span><span style=\"color: #657B83\">()).</span><span style=\"color: #268BD2\">handle</span><span style=\"color: #657B83\">(req);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #268BD2\">route</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">handler</span><span style=\"color: #657B83\">(handler);</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  </span><span style=\"color: #586E75; font-weight: bold\">private</span><span style=\"color: #657B83\"> </span><span style=\"color: #586E75; font-weight: bold\">Method</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">findReceipter</span><span style=\"color: #657B83\">(</span><span style=\"color: #586E75; font-weight: bold\">Request</span><span style=\"color: #657B83\"> req) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val addr </span><span style=\"color: #859900\">=</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">req</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAddr</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    val receipt </span><span style=\"color: #859900\">=</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">      </span><span style=\"color: #268BD2\">Trunk</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">RECEIPTS</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">stream</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">filter</span><span style=\"color: #657B83\">(d </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">d</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getAddr</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">equals</span><span style=\"color: #657B83\">(addr))</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        .</span><span style=\"color: #268BD2\">findAny</span><span style=\"color: #657B83\">().</span><span style=\"color: #268BD2\">orElseThrow</span><span style=\"color: #657B83\">(() </span><span style=\"color: #586E75; font-weight: bold\">-&gt;</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">new</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">NullPointerException</span><span style=\"color: #657B83\">(</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">        </span><span style=\"color: #2AA198\">&quot;No method under the @EventBus class for the @Addr annotation value &quot;</span><span style=\"color: #657B83\"> </span><span style=\"color: #859900\">+</span><span style=\"color: #657B83\"> addr </span><span style=\"color: #859900\">+</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">          </span><span style=\"color: #2AA198\">&quot; was found&quot;</span><span style=\"color: #657B83\">));</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">    </span><span style=\"color: #859900\">return</span><span style=\"color: #657B83\"> </span><span style=\"color: #268BD2\">receipt</span><span style=\"color: #657B83\">.</span><span style=\"color: #268BD2\">getMethod</span><span style=\"color: #657B83\">();</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color: #657B83\">&#125;</span></span></code></pre></div><hr>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>这一篇我们把Vert.x中路由使用改造成我们最熟悉的Spring注解式开发模式了,以后使用的话更加顺手习惯.</p>\n","text":"上一篇讲完了全局配置,这一篇我们来讲每个路由的集成. Vert.x原始使用方式样例来自于Vert.x官网 Vert.x配置api接口javapublic cla...","permalink":"/post/从零开始撸框架(8)-与Vert.x集成 Web篇(二)","photos":[],"count_time":{"symbolsCount":"24k","symbolsTime":"22 mins."},"categories":[{"name":"从零开始","slug":"从零开始","count":8,"path":"api/categories/从零开始.json"}],"tags":[{"name":"Vert.x","slug":"Vert-x","count":8,"path":"api/tags/Vert-x.json"},{"name":"Actor","slug":"Actor","count":8,"path":"api/tags/Actor.json"},{"name":"设计模式","slug":"设计模式","count":8,"path":"api/tags/设计模式.json"},{"name":"Java","slug":"Java","count":9,"path":"api/tags/Java.json"},{"name":"代理模式","slug":"代理模式","count":4,"path":"api/tags/代理模式.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Vert-x%E5%8E%9F%E5%A7%8B%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">Vert.x原始使用方式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Vert-x%E9%85%8D%E7%BD%AEapi%E6%8E%A5%E5%8F%A3\"><span class=\"toc-text\">Vert.x配置api接口</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%9D%99%E6%80%81%E8%A7%A3%E6%9E%90\"><span class=\"toc-text\">静态解析</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%B7%E6%B1%82%E8%B7%AF%E5%BE%84\"><span class=\"toc-text\">请求路径</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">请求方式</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AA%92%E4%BD%93%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">媒体类型</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81\"><span class=\"toc-text\">响应状态</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%89%AB%E6%8F%8F%E5%99%A8\"><span class=\"toc-text\">扫描器</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%8E%A5%E5%8F%A3%E6%89%AB%E6%8F%8F%E5%99%A8\"><span class=\"toc-text\">接口扫描器</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%AF%B7%E6%B1%82%E6%89%AB%E6%8F%8F%E5%99%A8\"><span class=\"toc-text\">请求扫描器</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">测试</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8A%A8%E6%80%81%E8%A7%A3%E6%9E%90\"><span class=\"toc-text\">动态解析</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0\"><span class=\"toc-text\">请求参数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E7%B1%BB\"><span class=\"toc-text\">基类</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">具体实现</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#http%E5%B7%A5%E4%BD%9C%E6%B5%81\"><span class=\"toc-text\">http工作流</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E7%B1%BB-1\"><span class=\"toc-text\">基类</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-1\"><span class=\"toc-text\">具体实现</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li></ol>","author":{"name":"因雨而生","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"一直没脱离低级趣味的Coder","socials":{"github":"https://github.com/BornToRain","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"点云开发(1)-环境搭建(Ubuntu)","uid":"1e6a3f5bd40a4242218066355e4892b4","slug":"点云开发(1)-环境搭建(Ubuntu)","date":"2024-03-28T05:40:23.000Z","updated":"2024-03-28T16:10:14.760Z","comments":true,"path":"api/articles/点云开发(1)-环境搭建(Ubuntu).json","keywords":["Coder","Scalaer","Javaer"],"cover":"/images/ros2logo.png","text":"前言记录下开发环境的搭建过程. 所需软件开发所需: Ubuntu 20.04(操作系统) Ros2 Foxy(Robot Operating System机器人...","permalink":"/post/点云开发(1)-环境搭建(Ubuntu)","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"点云","slug":"点云","count":5,"path":"api/categories/点云.json"}],"tags":[{"name":"Ros2","slug":"Ros2","count":2,"path":"api/tags/Ros2.json"},{"name":"PCL","slug":"PCL","count":4,"path":"api/tags/PCL.json"},{"name":"Ubuntu","slug":"Ubuntu","count":1,"path":"api/tags/Ubuntu.json"}],"author":{"name":"因雨而生","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"一直没脱离低级趣味的Coder","socials":{"github":"https://github.com/BornToRain","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"从零开始撸框架(7)-与Vert.x集成 Web篇(一)","uid":"c38b17588d251cd9846139dacf4f50ed","slug":"从零开始撸框架(7)-与Vert.x集成 Web篇(一)","date":"2021-05-10T06:50:32.000Z","updated":"2021-06-09T08:46:02.182Z","comments":true,"path":"api/articles/从零开始撸框架(7)-与Vert.x集成 Web篇(一).json","keywords":["Coder","Scalaer","Javaer"],"cover":"/images/vertxlogo.png","text":"上一篇讲完了与Vert.x集成的整体情况,这一篇开始与vertx-web集成. 这些内容我们主要在web模块中进行开发. Web全局集成web组件下的build...","permalink":"/post/从零开始撸框架(7)-与Vert.x集成 Web篇(一)","photos":[],"count_time":{"symbolsCount":"7.9k","symbolsTime":"7 mins."},"categories":[{"name":"从零开始","slug":"从零开始","count":8,"path":"api/categories/从零开始.json"}],"tags":[{"name":"Vert.x","slug":"Vert-x","count":8,"path":"api/tags/Vert-x.json"},{"name":"Actor","slug":"Actor","count":8,"path":"api/tags/Actor.json"},{"name":"设计模式","slug":"设计模式","count":8,"path":"api/tags/设计模式.json"},{"name":"Java","slug":"Java","count":9,"path":"api/tags/Java.json"},{"name":"代理模式","slug":"代理模式","count":4,"path":"api/tags/代理模式.json"}],"author":{"name":"因雨而生","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"一直没脱离低级趣味的Coder","socials":{"github":"https://github.com/BornToRain","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}